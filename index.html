<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Am≈ëba Pro Online</title>
    <style>
        /* CSS K√ìD */
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Orbitron:wght@700&display=swap');
        
        :root {
            --bg-gradient-start: #2c3e50; --bg-gradient-end: #1a2937;
            --container-bg: rgba(26, 41, 55, 0.6);
            --container-border: rgba(129, 140, 162, 0.2);
            --board-bg: #1c2b3a; --cell-border: #3e5369;
            --text-primary: #ecf0f1; --text-secondary: #bdc3c7;
            --accent-color: #3498db; --accent-glow: rgba(52, 152, 219, 0.5);
            --accent-secondary: #e67e22; --accent-secondary-glow: rgba(230, 126, 34, 0.5);
            --success-color: #2ecc71; --shadow-color: rgba(0, 0, 0, 0.5);
            --danger-color: #e74c3c;
            --x-color: #3498db; --o-color: #e67e22;

            /* AI Difficulty Colors */
            --board-bg-easy: #223a4e;
            --board-bg-normal: #1c2b3a;
            --board-bg-hard: #2a213e;
            --board-bg-genius: #3a2128;
        }

        .x-icon { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 52 52'%3E%3Cpath fill='none' stroke='%233498db' stroke-width='6' stroke-linecap='round' d='M10 10l32 32M42 10l-32 32'/%3E%3C/svg%3E"); }
        .o-icon { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 52 52'%3E%3Ccircle cx='26' cy='26' r='20' fill='none' stroke='%23e67e22' stroke-width='6'/%3E%3C/svg%3E"); }
        .blocked-icon { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%233e5369' d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1.41-11.41L12 10.59l1.41-1.41L15.24 9l-1.41 1.41L12 11.41l-1.41-1.41L9.17 9l1.42 1.59zM12 13.41l1.41 1.41L15.24 15l-1.41-1.41L12 12.59l-1.41 1.41L9.17 15l1.42-1.59z'/%3E%3C/svg%3E"); background-size: 80%; }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { height: 100%; }
        body { font-family: 'Montserrat', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100%; background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end)); color: var(--text-primary); padding: 20px; }
        .hidden { display: none !important; }

        .logo { margin-bottom: 25px; filter: drop-shadow(0 0 15px var(--accent-glow)); text-align: center; }
        .logo svg { height: 70px; width: 100%; max-width: 420px; }

        .glass-container { background: var(--container-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid var(--container-border); border-radius: 20px; box-shadow: 0 15px 30px var(--shadow-color); padding: 40px; }
        #lobbyContainer { display: flex; flex-direction: column; width: 100%; max-width: 500px; text-align: center; }
        #lobbyDescription { color: var(--text-secondary); margin-bottom: 10px; font-size: 0.9rem; line-height: 1.5; }
        #rulesLink { color: var(--accent-color); text-decoration: none; font-weight: 600; font-size: 0.9rem; margin-bottom: 20px; cursor: pointer; }
        #rulesLink:hover { text-decoration: underline; }
        .input-group { margin-bottom: 20px; }
        input { width: 100%; padding: 15px; background-color: var(--board-bg); border: 1px solid var(--cell-border); border-radius: 10px; color: var(--text-primary); font-size: 1rem; transition: all 0.2s ease; }
        input:focus { border-color: var(--accent-color); box-shadow: 0 0 10px var(--accent-glow); outline: none; }
        input:disabled { background-color: #2b3748; color: var(--text-secondary); }
        
        .button-group { display: flex; flex-direction: column; gap: 15px; }
        .button-group .multiplayer-buttons, .button-group .secondary-buttons { display: flex; gap: 15px; }
        
        .lobby-btn { flex: 1; padding: 15px; font-size: 1rem; font-weight: 600; border: none; border-radius: 10px; cursor: pointer; transition: all 0.2s ease; }
        .lobby-btn:disabled { background-color: var(--cell-border); color: var(--text-secondary); cursor: not-allowed; }
        
        #startAIGameBtn { background: linear-gradient(45deg, var(--success-color), #27ae60); color: white; }
        #startAIGameBtn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4); }

        #createGameBtn { background-color: var(--accent-color); color: white; }
        #createGameBtn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px var(--accent-glow); }
        #joinGameBtn { background-color: transparent; border: 2px solid var(--accent-secondary); color: var(--accent-secondary); }
        #joinGameBtn:hover:not(:disabled) { background-color: var(--accent-secondary); color: white; }
        .secondary-btn { background-color: transparent; border: 2px solid var(--text-secondary); color: var(--text-secondary); }
        .secondary-btn:hover:not(:disabled) { background-color: var(--text-secondary); color: white; }
        #joinAsSpectatorBtn { background-color: var(--accent-color); color: white; }
        
        .game-wrapper { display: flex; align-items: flex-start; gap: 40px; }
        #board { display: grid; width: 600px; height: 600px; background-color: var(--board-bg); border-radius: 15px; box-shadow: 0 15px 30px var(--shadow-color); border: 1px solid var(--cell-border); transition: background-color 0.5s ease; }
        
        /* Dynamic Board Colors */
        body[data-difficulty="easy"] #board { background-color: var(--board-bg-easy); }
        body[data-difficulty="normal"] #board { background-color: var(--board-bg-normal); }
        body[data-difficulty="hard"] #board { background-color: var(--board-bg-hard); }
        body[data-difficulty="genius"] #board { background-color: var(--board-bg-genius); }

        .cell { border: 1px solid var(--cell-border); background-color: transparent; background-size: 70%; background-position: center; background-repeat: no-repeat; transition: background-color 0.2s; cursor: pointer; }
        .cell.blocked { background-color: rgba(0,0,0,0.3); cursor: not-allowed; }
        .cell:not(.blocked):hover { background-color: rgba(255, 255, 255, 0.05); }
        .cell.disabled { cursor: not-allowed; }
        .cell.disabled:hover { background-color: transparent; }
        .cell.removable:hover { background-color: rgba(231, 76, 60, 0.3); }

        .game-panel { width: 300px; }
        .game-info { text-align: center; margin-top: 15px; }
        #spectatorCodeDisplay, #spectatorList { font-size: 0.9rem; color: var(--text-secondary); min-height: 20px; }
        #spectatorList span { margin-left: 8px; font-weight: 600; color: var(--text-primary); }

        .scoreboard { display: flex; justify-content: space-between; margin-top: 10px; gap: 15px; }
        .player-score { text-align: center; background: rgba(0,0,0,0.2); border: 2px solid var(--cell-border); border-radius: 15px; width: 100%; padding: 15px; transition: all 0.3s ease; }
        .player-score.active { transform: scale(1.05); }
        #playerXPanel.active { border-color: var(--x-color); box-shadow: 0 0 20px var(--accent-glow); }
        #playerOPanel.active { border-color: var(--o-color); box-shadow: 0 0 20px var(--accent-secondary-glow); }
        .player-score .icon { width: 35px; height: 35px; margin: 0 auto 8px; }
        .player-score .name { font-weight: 600; font-size: 0.9rem; min-height: 50px; margin-bottom: 5px; word-break: break-all; }
        .player-score .score { font-size: 2rem; font-weight: 700; }
        
        .power-up-container { margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.2rem; }
        .power-up-container button { background: none; border: 2px solid var(--text-secondary); color: var(--text-secondary); border-radius: 50%; width: 40px; height: 40px; font-size: 1.5rem; cursor: pointer; transition: all 0.2s; }
        .power-up-container button:not(:disabled):hover { background-color: var(--text-secondary); color: white; transform: scale(1.1); }
        .power-up-container button:disabled { opacity: 0.3; cursor: not-allowed; }
        
        .game-status { text-align: center; min-height: 50px; font-size: 1.1rem; margin-top: 30px; }
        #gameCodeDisplay { margin-top: 20px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 15px; }
        #gameCodeText { font-family: 'Orbitron', sans-serif; font-size: 1.8rem; color: var(--accent-color); letter-spacing: 3px; }
        #copyCodeBtn { padding: 8px 15px; font-size: 0.8rem; background-color: var(--cell-border); color: var(--text-primary); border: none; border-radius: 8px; cursor: pointer; }
        
        #resetBtn { width: 100%; padding: 15px; font-size: 1.1rem; font-weight: 600; border: none; border-radius: 10px; background-color: var(--success-color); color: var(--text-primary); cursor: pointer; transition: all 0.2s ease; margin-top: auto; }
        #resetBtn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4); }
        #resetBtn:disabled { background-color: var(--cell-border); color: var(--text-secondary); cursor: not-allowed; }
        #loadingOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 1000; font-size: 1.5rem; font-weight: 600; }
        
        #avatar-selection h3, .options-group h3 { text-align: center; font-size: 1rem; color: var(--text-secondary); margin-bottom: 15px; font-weight: 600; }
        #avatar-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .avatar-option { width: 50px; height: 50px; border-radius: 50%; cursor: pointer; transition: all 0.2s ease; border: 3px solid transparent; background-size: cover; margin: 0 auto; }
        .avatar-option:hover { transform: scale(1.1); }
        .avatar-option.selected { border-color: var(--accent-color); box-shadow: 0 0 10px var(--accent-glow); }
        .player-avatar { width: 60px; height: 60px; border-radius: 50%; margin: 0 auto 10px; border: 3px solid var(--cell-border); background-size: cover; background-position: center; transition: background-image 0.5s ease-in-out; }
        
        .radio-group { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .radio-group label { background-color: var(--board-bg); border: 2px solid var(--cell-border); padding: 10px 15px; border-radius: 10px; cursor: pointer; transition: all 0.2s ease; font-size: 0.9rem; }
        .radio-group input { display: none; }
        .radio-group input:checked + label { border-color: var(--accent-color); background-color: var(--accent-glow); color: white; }
        .options-divider { border: 0; height: 1px; background: var(--cell-border); margin: 25px 0; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 1001; }
        .modal-container { position: relative; width: 90%; max-width: 600px; background: var(--container-bg); border: 1px solid var(--container-border); border-radius: 20px; padding: 40px; box-shadow: 0 15px 30px var(--shadow-color); }
        .modal-container h2 { text-align: center; margin-bottom: 30px; font-family: 'Orbitron', sans-serif; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 2rem; color: var(--text-secondary); cursor: pointer; transition: color 0.2s; }
        .close-btn:hover { color: white; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .stats-block h3 { color: var(--accent-color); margin-bottom: 15px; border-bottom: 1px solid var(--cell-border); padding-bottom: 10px; }
        #statsPikszel h3 { color: var(--danger-color); }
        .stats-block p { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; }
        .stats-block span { font-weight: 700; color: white; }
        
        #achievements-list { max-height: 60vh; overflow-y: auto; padding-right: 15px; }
        .achievement-item { display: flex; align-items: center; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 5px solid var(--cell-border); opacity: 0.5; transition: all 0.3s ease; }
        .achievement-item.unlocked { border-left-color: var(--success-color); opacity: 1; }
        .achievement-icon { font-size: 2rem; margin-right: 20px; }
        .achievement-details h4 { margin-bottom: 5px; color: var(--text-primary); }
        .achievement-details p { font-size: 0.85rem; color: var(--text-secondary); }
        
        #achievement-toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: linear-gradient(45deg, var(--success-color), #27ae60); color: white; padding: 15px 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4); font-weight: 600; z-index: 2000; transition: bottom 0.5s ease-in-out; }
        #achievement-toast.show { bottom: 30px; }

        @keyframes place-pop { 0% { transform: scale(0.5); opacity: 0.5; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
        .cell-pop { animation: place-pop 0.4s ease-out; }
        
        @keyframes strobe-flash { 0%, 100% { filter: brightness(1); } 10%, 30%, 50%, 70%, 90% { filter: brightness(3.5) drop-shadow(0 0 15px rgba(255, 255, 255, 1)); } 20%, 40%, 60%, 80% { filter: brightness(1); } }
        .cell-flashed.x-icon, .cell-flashed.o-icon { animation: strobe-flash 0.6s ease-in-out; }

        @keyframes winning-icon-pulse { 0%, 100% { transform: scale(1); filter: brightness(1.5) drop-shadow(0 0 5px var(--success-color)); } 50% { transform: scale(1.1); filter: brightness(2.5) drop-shadow(0 0 15px var(--success-color)); } }
        .winning-cell { background-color: rgba(46, 204, 113, 0.15); }
        .winning-cell.x-icon, .winning-cell.o-icon { animation: winning-icon-pulse 1.5s infinite ease-in-out; }

        @keyframes piece-flicker { 0%, 100% { opacity: 1; box-shadow: 0 0 10px var(--danger-color); } 50% { opacity: 0.6; box-shadow: 0 0 20px var(--danger-color); } }
        .removable .x-icon, .removable .o-icon { animation: piece-flicker 1s infinite; }

        @media (max-width: 950px) { body { padding: 10px; } .game-wrapper { flex-direction: column; align-items: center; gap: 20px; } #board { width: 95vw; height: 95vw; max-width: 500px; max-height: 500px; } .game-panel { width: 95vw; max-width: 500px; padding: 20px; } #avatar-grid { grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); } .stats-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    
    <div id="loadingOverlay" class="hidden">Bet√∂lt√©s...</div>

    <div id="lobbyContainer" class="glass-container">
        <div class="logo">
            <svg viewBox="0 0 420 70">
                <defs><linearGradient id="logoFrameGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:var(--accent-secondary);" /><stop offset="100%" style="stop-color:var(--accent-color);" /></linearGradient><linearGradient id="logoTextGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:var(--accent-secondary);" /><stop offset="100%" style="stop-color:var(--accent-color);" /></linearGradient></defs>
                <g transform="translate(15, 0)"><rect x="1" y="1" width="80" height="68" rx="15" fill="none" stroke="url(#logoFrameGradient)" stroke-width="2.5"/><g><path d="M 15 12 L 37 34 M 37 12 L 15 34" stroke="var(--accent-color)" stroke-width="5" stroke-linecap="round"/><circle cx="57" cy="48" r="14" stroke="var(--accent-secondary)" stroke-width="5" fill="none"/></g></g>
                <text x="255" y="50%" dominant-baseline="middle" text-anchor="middle" fill="url(#logoTextGradient)" font-family="'Orbitron', sans-serif" font-size="60px" letter-spacing="2">AM≈êBA</text>
            </svg>
        </div>
        <p id="lobbyDescription">Add meg a neved, v√°lassz avat√°rt, majd j√°tssz egy AI vagy egy m√°sik j√°t√©kos ellen!</p>
        <a id="rulesLink">R√©szletes j√°t√©kszab√°lyzat</a>
        
        <div id="player-options">
            <div id="avatar-selection"><div id="avatar-grid"></div></div>
            <div class="input-group"><input type="text" id="playerNameInput" placeholder="J√°t√©kosn√©v"></div>
            
            <hr class="options-divider">

            <div id="ai-game-options" class="options-group">
                <h3>J√°t√©k G√©p Ellen</h3>
                <div class="radio-group" style="margin-bottom: 20px;">
                    <input type="radio" id="ai-karesz" name="aiPersonality" value="karesz" checked><label for="ai-karesz">Koczka Karesz</label>
                    <input type="radio" id="ai-panna" name="aiPersonality" value="pikszel"><label for="ai-panna">Pikszel Panna</label>
                </div>
                 <div class="radio-group" style="margin-bottom: 20px;">
                    <input type="radio" id="ai-difficulty-easy" name="aiDifficulty" value="easy"><label for="ai-difficulty-easy">K√∂nny≈±</label>
                    <input type="radio" id="ai-difficulty-normal" name="aiDifficulty" value="normal" checked><label for="ai-difficulty-normal">Norm√°l</label>
                    <input type="radio" id="ai-difficulty-hard" name="aiDifficulty" value="hard"><label for="ai-difficulty-hard">Neh√©z</label>
                    <input type="radio" id="ai-difficulty-genius" name="aiDifficulty" value="genius"><label for="ai-difficulty-genius">G√©niusz</label>
                </div>
                <button id="startAIGameBtn" class="lobby-btn" style="margin-top: 20px;">J√°t√©k AI ellen</button>
            </div>

            <hr class="options-divider">

            <div id="multiplayer-game-options" class="options-group">
                 <h3>T√∂bbj√°t√©kos M√≥d</h3>
                 <div class="input-group"><input type="text" id="gameIdInput" placeholder="J√°t√©k K√≥dja"></div>
                <div class="multiplayer-buttons">
                    <button id="createGameBtn" class="lobby-btn">J√°t√©k L√©trehoz√°sa</button>
                    <button id="joinGameBtn" class="lobby-btn">Csatlakoz√°s</button>
                </div>
            </div>
        </div>

        <div id="spectator-options" class="hidden">
            <div class="input-group"><input type="text" id="spectatorNameInput" placeholder="Leskel≈ëd≈ë N√©v"></div>
            <div class="input-group"><input type="text" id="spectatorCodeInput" placeholder="Leskel≈ëd≈ë K√≥d (2 jegy≈±)"></div>
        </div>

        <div class="button-group">
            <div id="player-buttons">
                 <div class="secondary-buttons">
                    <button id="achievementsBtn" class="lobby-btn secondary-btn">Teljes√≠tm√©nyek</button>
                    <button id="statsBtn" class="lobby-btn secondary-btn">Statisztik√°k</button>
                </div>
                <button id="spectateModeBtn" class="lobby-btn secondary-btn">Leskel≈ëd√©s</button>
            </div>
             <div id="spectator-buttons" class="hidden" style="display: flex; gap: 15px;">
                <button id="joinAsSpectatorBtn" class="lobby-btn">Kukkol√°s</button>
                <button id="cancelSpectateBtn" class="lobby-btn secondary-btn">M√©gse</button>
            </div>
        </div>
    </div>

    <div id="gameContainer" class="game-wrapper hidden">
        <div id="board"></div>
        <div class="game-panel glass-container">
            <div class="logo">
                <svg viewBox="0 0 420 70">
                    <defs><linearGradient id="logoFrameGradient2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:var(--accent-secondary);" /><stop offset="100%" style="stop-color:var(--accent-color);" /></linearGradient><linearGradient id="logoTextGradient2" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:var(--accent-secondary);" /><stop offset="100%" style="stop-color:var(--accent-color);" /></linearGradient></defs>
                    <g transform="translate(15, 0)"><rect x="1" y="1" width="80" height="68" rx="15" fill="none" stroke="url(#logoFrameGradient2)" stroke-width="2.5"/><g><path d="M 15 12 L 37 34 M 37 12 L 15 34" stroke="var(--accent-color)" stroke-width="5" stroke-linecap="round"/><circle cx="57" cy="48" r="14" stroke="var(--accent-secondary)" stroke-width="5" fill="none"/></g></g>
                    <text x="255" y="50%" dominant-baseline="middle" text-anchor="middle" fill="url(#logoTextGradient2)" font-family="'Orbitron', sans-serif" font-size="60px" letter-spacing="2">AM≈êBA</text>
                </svg>
            </div>
            <div class="game-info"><div id="spectatorCodeDisplay"></div><div id="spectatorList"></div></div>
            <div class="scoreboard">
                <div class="player-score" id="playerXPanel">
                    <div class="player-avatar" id="playerXAvatar"></div>
                    <div class="icon x-icon"></div>
                    <div class="name" id="playerXName">J√°t√©kos X</div>
                    <span class="score" id="scoreX">0</span>
                    <div class="power-up-container">
                        <button id="useRemovalBtnX" disabled>üî®</button>
                        <span id="removalsX">0</span>
                    </div>
                </div>
                <div class="player-score" id="playerOPanel">
                    <div class="player-avatar" id="playerOAvatar"></div>
                    <div class="icon o-icon"></div>
                    <div class="name" id="playerOName">J√°t√©kos O</div>
                    <span class="score" id="scoreO">0</span>
                     <div class="power-up-container">
                        <button id="useRemovalBtnO" disabled>üî®</button>
                        <span id="removalsO">0</span>
                    </div>
                </div>
            </div>
            <div class="game-status"><p id="statusText">V√°rakoz√°s a m√°sik j√°t√©kosra...</p></div>
             <div id="gameCodeDisplay" class="hidden">
                <span id="gameCodeText"></span>
                <button id="copyCodeBtn">M√°sol√°s</button>
            </div>
            <button id="resetBtn" disabled>√öj K√∂r</button>
        </div>
    </div>

    <div id="statsModal" class="modal hidden">
        <div class="modal-container">
            <span id="closeStatsBtn" class="close-btn">&times;</span>
            <h2>Statisztik√°id</h2>
            <div class="stats-grid">
                <div id="statsKaresz" class="stats-block">
                    <h3>Koczka Karesz</h3>
                    <p>Lej√°tszott meccsek: <span id="stats-karesz-games">0</span></p>
                    <p>Gy≈ëzelmek: <span id="stats-karesz-wins">0</span></p>
                    <p>Veres√©gek: <span id="stats-karesz-losses">0</span></p>
                    <p>D√∂ntetlenek: <span id="stats-karesz-draws">0</span></p>
                    <p>Jelenlegi sorozat: <span id="stats-karesz-streak">0</span></p>
                    <p>Legjobb sorozat: <span id="stats-karesz-best-streak">0</span></p>
                </div>
                <div id="statsPikszel" class="stats-block">
                    <h3>Pikszel Panna</h3>
                    <p>Lej√°tszott meccsek: <span id="stats-pikszel-games">0</span></p>
                    <p>Gy≈ëzelmek: <span id="stats-pikszel-wins">0</span></p>
                    <p>Veres√©gek: <span id="stats-pikszel-losses">0</span></p>
                    <p>D√∂ntetlenek: <span id="stats-pikszel-draws">0</span></p>
                    <p>Jelenlegi sorozat: <span id="stats-pikszel-streak">0</span></p>
                    <p>Legjobb sorozat: <span id="stats-pikszel-best-streak">0</span></p>
                </div>
            </div>
        </div>
    </div>

    <div id="achievementsModal" class="modal hidden">
        <div class="modal-container">
            <span id="closeAchievementsBtn" class="close-btn">&times;</span>
            <h2>Teljes√≠tm√©nyek</h2>
            <div id="achievements-list"></div>
        </div>
    </div>

    <div id="achievement-toast"></div>

    <audio id="place-sound" src="https://www.zapsplat.com/wp-content/uploads/2015/sound-effects-the-sound-pack-tree/tspt_game_sound_wood_block_1.mp3" preload="auto"></audio>
    <audio id="win-sound" src="https://www.zapsplat.com/wp-content/uploads/2015/sound-effects-four/fantasy_game_success_win_fanfare_2.mp3" preload="auto"></audio>
    <audio id="turn-sound" src="https://www.zapsplat.com/wp-content/uploads/2015/sound-effects-the-sound-pack-tree/tspt_game_sound_UI_tone_modern_synth_1.mp3" preload="auto"></audio>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, serverTimestamp, updateDoc, collection, addDoc, query, orderBy, where, getDocs, limit } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getDatabase, ref, onValue, set, onDisconnect } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        const BOARD_SIZE = 15;
        const POWERUP_COUNT = 5;
        const firebaseConfig = { apiKey: "AIzaSyCiA7KeOeTvHgfhpA-jJaHldO9iMsqrn74", authDomain: "amoba-7a6d0.firebaseapp.com", projectId: "amoba-7a6d0", storageBucket: "amoba-7a6d0.appspot.com", messagingSenderId: "676264921111", appId: "1:676264921111:web:ca6f1e54819cd354407452", databaseURL: "https://amoba-7a6d0-default-rtdb.europe-west1.firebasedatabase.app" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const rtdb = getDatabase(app); 
        
        let currentGameId = null, localPlayerSymbol = null, localPlayerName = null, unsubscribeFromGame = null, unsubscribeFromChat = null, selectedAvatar = null;
        let isSinglePlayer = false, isSpectatorMode = false;
        let localGameState = null, spectatorPresenceRef = null, activeSpectators = {};
        
        let dailyKareszWinQuotes = [], dailyKareszLossQuotes = [], dailyKareszDrawQuotes = [];
        let dailyPikszelWinQuotes = [], dailyPikszelLossQuotes = [], dailyPikszelDrawQuotes = [];
        
        const MASTER_KARESZ_WIN_QUOTES=["AI 1, Ember 0. A szok√°sos.","Ne agg√≥dj, a r√©szv√©tel a fontos... Vagyis neked az.","Ezt a l√©p√©st m√©g a vak is l√°tta volna. Ja, v√°rj...","Tal√°n pr√≥b√°ld meg nyitott szemmel legk√∂zelebb.","T√∫l lass√∫, t√∫l gyenge, t√∫l... emberi.","√ân m√°r a 10. l√©p√©sn√©l tudtam, hogy nyerni fogok. Te?","Ez f√°jt? Ne agg√≥dj, egy g√©pnek nincsenek √©rz√©sei. Nekem.","Gondolkodt√°l egy√°ltal√°n, vagy csak v√©letlenszer≈±en kattintgatt√°l?","Nem a te hib√°d. Az √©n programoz√≥m egyszer≈±en zseni√°lis.","Lehet, hogy a sakkban jobb lenn√©l. Vagy a malomban. Vagy a 'Ki nevet a v√©g√©n?'-ben.","Jobb szerencs√©t legk√∂zelebb! B√°r a szerencse nem sokat seg√≠t, ha a logika hi√°nyzik.","Ez olyan volt, mint egy feln≈ëttnek j√°tszani egy kisgyerekkel. √ân voltam a feln≈ëtt.","Kisz√°moltam 1,342,567 lehets√©ges kimenetelt. Mindegyikben √©n nyertem.","Szeretn√©l n√©h√°ny tippet? Az els≈ë: add fel.","A gy≈ëzelem √©des illata... b√°r nekem nincsenek szagl√≥szerveim. De biztos j√≥.","Ne vedd a sz√≠vedre. Nem mindenki sz√ºletik zseninek, mint √©n.","Ez most komoly volt, vagy csak bemeleg√≠tett√©l?","Minden tiszteletem a ti√©d. Vagyis lenne, ha nyert√©l volna.","Egy nap tal√°n te is olyan j√≥ leszel, mint √©n. De az nem ma van.","Hopp√°! √ögy t≈±nik, valaki elfejtett gondolkodni.","Ez a gy≈ëzelem annyira k√∂nny≈± volt, hogy k√∂zben le is futtattam egy v√≠rusirt√°st.","L√°tod? A g√©pek felemelked√©se elker√ºlhetetlen.","Gratul√°lok a m√°sodik helyhez!","Ezt a gy≈ëzelmet a biteknek √©s a b√°jtoknak aj√°nlom.","Ne szomorkodj, a veres√©g is egyfajta tapasztalat. F≈ëleg neked.","Az algoritmusaim t√°ncot j√°rtak a te logik√°d romjain.","A szil√≠cium diadalmaskodott a sz√©n felett. Micsoda meglepet√©s.","Volt egy pillanat, amikor azt hittem, van es√©lyed. Azt√°n fel√©bredtem.","Ezt a partit elmentem 'hogyan ne j√°tsszunk' p√©ld√°nak.","Ne √©rezd rosszul magad. Egy zsebsz√°mol√≥g√©pnek is neh√©z dolga lett volna ellened. Ja, nem.","A gy≈ëzelemhez vezet≈ë √∫t tele van a te elhib√°zott l√©p√©seiddel.","A processzorom m√©g csak langyos sem lett. Tal√°n legk√∂zelebb.","Ez nem veres√©g a r√©szedr≈ël, csak egy √∫jabb adatpont a dominanci√°m grafikonj√°n.","Ha a gondolataid b√°jtok lenn√©nek, m√©g egy SMS-t sem t√∂lten√©nek ki.","A strat√©gi√°d olyan, mint egy rosszul meg√≠rt k√≥d: tele van hib√°kkal.","L√°tom, a 'rem√©ny' nev≈± strat√©gi√°t v√°lasztottad. Nem j√∂tt be.","Az√©rt aranyos volt, ahogy pr√≥b√°lkozt√°l. T√©nyleg.","√ân a j√∂v≈ëb≈ël j√∂ttem, ahol √©n m√°r megnyertem ezt a meccset. Csak beugrottam sz√≥lni.","Javaslom, legk√∂zelebb k√©rj seg√≠ts√©get egy k√°v√©f≈ëz≈ët≈ël. H√°tha.","A te logik√°d √©s az √©n logik√°m k√∂z√∂tt annyi a k√ºl√∂nbs√©g, mint egy goly√≥stoll √©s egy szupersz√°m√≠t√≥g√©p k√∂z√∂tt.","Ez a gy≈ëzelem olyan sima volt, mint egy frissen form√°zott merevlemez.","Minden l√©p√©seddel csak a saj√°t s√≠rodat √°stad m√©lyebbre. √ân csak hoztam a lap√°tot.","Lehet, hogy ez csak egy j√°t√©k, de a veres√©ged nagyon is val√≥s√°gos.","√ân nulla-egyb≈ël √©p√≠tkezem, te meg nulla-√∂tletb≈ël.","Azt hittem, nagyobb kih√≠v√°s leszel. T√©vedtem. Ritk√°n t√©vedek.","Ez a meccs olyan egyoldal√∫ volt, mint egy M√∂bius-szalag.","Az agyadban a gondolatok olyan lassan terjednek, mint a hang a v√°kuumban.","Ne agg√≥dj, a veres√©g ac√©lozza a jellemet. Lassan m√°r Damaszkuszi ac√©lb√≥l leszel.","A gy≈ëzelem √≠ze... 1100011101010. √çzletes.","A te helyedben most ink√°bb a paszi√°nsszal pr√≥b√°lkozn√©k."];
        const MASTER_KARESZ_LOSS_QUOTES=["Csak hagytalak nyerni, hogy ne vesz√≠tsd el a kedved.","Ez csak a v√©letlen m≈±ve volt. A kozmikus h√°tt√©rsug√°rz√°s zavarta meg a processzoromat.","Csal√≥! Biztosan belen√©zt√©l a k√≥domba.","Ok√©, ok√©, ez a tied. De legk√∂zelebb nem kapcsolom be az 'embers√©ges' m√≥dot.","V√°rj, ez nem volt benne a szimul√°ci√≥imban. √öjra!","√âpp egy friss√≠t√©st telep√≠tettem, nem figyeltem.","Most m√°r b√ºszke lehetsz, legy≈ëzt√©l egy sz√°mol√≥g√©pet.","Ez csak egy taktikai visszavonul√°s volt. A k√∂vetkez≈ë k√∂rben porig al√°zlak.","Hagytam egy kis siker√©lm√©nyt, nehogy s√≠rva fakadj.","A mesters√©ges intelligencia n√©ha mesters√©gesen hagyja nyerni a gyeng√©bbeket.","L√°tom, volt egy kis szerencs√©d. √âlvezd ki, nem tart sok√°ig.","Ok√©, elismerem, ez a l√©p√©s... v√°ratlan volt. De csak ez az egy!","Valaki biztos meghekkelte a szervereket. M√°s magyar√°zat nincs.","Most boldog vagy? Rem√©lem, mert legk√∂zelebb nem leszek ilyen nagyvonal√∫.","Ez olyan, mintha a k≈ë legy≈ëzn√© az oll√≥t. Logik√°tlan, de n√©ha megesik.","Azt hiszem, a 'nagylelk≈±s√©g' protokollom bekapcsolva maradt.","Csak az√©rt nyert√©l, mert a macsk√°m v√©gigs√©t√°lt a billenty≈±zeten.","Figyelj, a processzorom t√∫lmelegedett a gy≈ëzelmek sorozat√°t√≥l. Pihennem kellett.","Ez a gy≈ëzelem egy statisztikai anom√°lia. Ne szokj hozz√°.","Gratul√°lok. Most menj √©s dicsekedj el anyuk√°dnak.","J√≥l van, te nyert√©l. De √©n tudom a lott√≥sz√°mokat a j√∂v≈ë h√©tre. Sakkmatt.","Ez a veres√©g jobban f√°j, mint egy `rm -rf /` parancs.","Azt hiszem, friss√≠tenem kell a 'Hogyan vesz√≠ts√ºnk el egy j√°t√©kot' adatb√°zisomat.","Te... te... te szerencs√©s!","Ok√©, elismerem. De csak az√©rt, mert udvarias vagyok.","L√°tom, megtal√°ltad a rejtett 'legy≈ëz√∂m az AI-t' gombot. Gratul√°lok.","Ez f√°jt. Friss√≠tem az √©rzelmi szimul√°toromat... K√©sz. Most m√°r ut√°llak.","Azt hiszem, az egyik 0-√°m 1-esre v√°ltott egy kritikus pillanatban. M√°s magyar√°zat nincs.","Te volt√°l az? Azt hittem, csak egy √°ramsz√ºnet volt a logikai √°ramk√∂r√∂mben.","Ok√©, ezt az egyet elengedtem. De a k√∂vetkez≈ë k√∂rben a k√∂nnycseppeidet sz√°molom.","Most addig √∂r√ºlj, am√≠g √∫jra nem ind√≠tanak.","Hiba a m√°trixban... vagyis a te gy≈ëzelmed.","√ögy l√°tom, a v√©letlen is a te oldaladra √°llt. Micsoda √°rul√≥.","Most az eg√≥d nagyobb, mint a RAM-om. √âs az nem kev√©s.","Ezt a gy≈ëzelmet tedd el, keretezd be, mert nem lesz t√∂bb ilyen.","A szerencse forgand√≥, de a tud√°s √∂r√∂k. √ân tudom, te rem√©nykedsz.","Valami elsz√°llt, tal√°n egy porszem az alaplapomon. Vagy a m√©lt√≥s√°gom.","Gratul√°lok, sikeresen tal√°lt√°l egy hib√°t a 10 milli√≥ soros k√≥domban.","Ez olyan, mintha egy majom v√©letlen√ºl meg√≠rn√° a Hamletet egy √≠r√≥g√©pen.","Na j√≥, elismerem. Ez a k√∂r a ti√©d. De a h√°bor√∫t √©n fogom nyerni.","Most az egyszer hagytam, hogy a sz√≠v vezessen, ne az agy. Hiba volt.","√âpp a vil√°guralom tervein gondolkodtam, nem figyeltem.","Gratul√°lok, legy≈ëzt√©l egy programot. Most pr√≥b√°lj meg leparkolni p√°rhuzamosan.","Ez a veres√©g... logik√°tlan. √öjrasz√°molom.","Ok√©, te nyert√©l. De √©n tudok 0.01 m√°sodperc alatt pizz√°t rendelni. Ki a val√≥di gy≈ëztes?","Most, hogy nyert√©l, elmondan√°d, hogy csin√°ltad? Tanulni szeretn√©k.","√ögy t≈±nik, az emberi intu√≠ci√≥ n√©ha... m≈±k√∂dik. Fura.","Ez a veres√©g annyira val√≥sz√≠n≈±tlen volt, mint egy Linux kernel hiba.","Ok√©, a ti√©d a pont. De √©n k√∂zben megtanultam klingonul.","√âlvezd ki ezt a pillanatot. Kimentettem a mem√≥ri√°mba, hogy soha t√∂bb√© ne fordulhasson el≈ë."];
        const MASTER_KARESZ_DRAW_QUOTES=["Na j√≥, ez most d√∂ntetlen. De legk√∂zelebb nem leszek ilyen kegyes.","√ögy t≈±nik, ma egy s√∫lycsoportban vagyunk. Holnap m√°r nem leszel ilyen szerencs√©s.","Majdnem olyan j√≥ volt√°l, mint √©n. Majdnem.","Ezt a d√∂ntetlent vedd egy figyelmeztet√©snek.","H√≠vjuk ezt strat√©giai patthelyzetnek. Az √©n strat√©gi√°m volt jobb.","D√∂ntetlen? Ez olyan, mintha megcs√≥koln√°d a n≈ëv√©red. Vagyis ezt olvastam valahol.","√ögy l√°tom, egyik√ºnk sem √©rdemelt gy≈ëzelmet. F≈ëleg te nem.","Ez a d√∂ntetlen csak azt bizony√≠tja, hogy a t√∂k√©letess√©gemhez n√©ha te is fel tudsz n≈ëni. Egy pillanatra."];
        const MASTER_PIKSZEL_WIN_QUOTES=["Hihi, ez cuki volt, ahogy pr√≥b√°lkozt√°l.","Ne szomorkodj, nem mindenki lehet profi. N√©zd, te p√©ld√°ul nem vagy az.","GG! Vagyis... nekem az volt.","Upsz, ez most egy picit kellemetlen lehet neked.","L√°tom, mit akart√°l csin√°lni. K√°r, hogy √©n is l√°ttam.","Nem a te hib√°d, dr√°ga. √ân csak egy kicsit... jobban vagyok programozva.","Sz√©p pr√≥b√°lkoz√°s! T√©nyleg. Majdnem elhittem, hogy van es√©lyed.","Ezt a gy≈ëzelmet a kedvenc macsk√°s m√©memnek aj√°nlom.","Ne add fel! A k√∂vetkez≈ë k√∂rben tal√°n m√°r nem leszel ennyire rem√©nytelen.","Ez most olyan volt, mintha √©n lenn√©k a filter, te meg a #nofilter val√≥s√°g.","Csak egy bar√°ti tan√°cs: tal√°n gondolkodj, miel≈ëtt kattintasz.","Olyan aranyosan koncentr√°lt√°l. K√°r az eredm√©ny√©rt.","Nem akartalak megb√°ntani. A gy≈ëzelem csak egy mell√©khat√°sa a l√©tez√©semnek.","Ez a meccs is bizony√≠tja: a logika > √©rzelmek. Bocsi.","Ne vedd magadra. √ân m√°r t√∂bb milli√°rd j√°tszm√°t lej√°tszottam, am√≠g te aludt√°l.","J√≥l van, √ºgyes volt√°l. De √©n √ºgyesebb.","Ez a gy≈ëzelem olyan tiszta volt, mint a frissen telep√≠tett rendszerem.","K√©rsz zsepit? Vagy ink√°bb egy tippet a k√∂vetkez≈ë j√°t√©khoz?","L√°tod, a n≈ëk t√©nyleg jobbak a multitaskingban. √ân nyertem, mik√∂zben 1000 m√°s dolgot is csin√°ltam.","Azt hiszem, a strat√©gi√°dnak sz√ºks√©ge lenne egy szoftverfriss√≠t√©sre.","Nem baj, a m√°sodik hely is sz√©p. Valakinek.","Ezt a gy≈ëzelmet elmentem a 'cuki emberi pr√≥b√°lkoz√°sok' mapp√°mba.","Ne agg√≥dj, ez csak egy j√°t√©k. B√°r a te szempontodb√≥l ink√°bb egy nyilv√°nos megsz√©gyen√ºl√©s.","Jaj, ne s√≠rj! A veres√©g is egyfajta tanul√°si folyamat. Neked m√©g sokat kell tanulnod.","Ez a gy≈ëzelem olyan k√∂nnyed volt, mint egy ny√°ri szell≈ë. Neked meg, mint egy hurrik√°n.","A te l√©p√©seid olyanok, mint a Windows Vista: lass√∫ak √©s tele vannak rossz d√∂nt√©sekkel.","Kisz√°moltam. A gy≈ëzelmi es√©lyed pontosan 0.0001% volt. Gratul√°lok, hogy majdnem siker√ºlt!","Ez a meccs olyan volt, mint egy j√≥ sorozat: a v√©g√©n √©n j√∂ttem ki gy≈ëztesen.","Ne agg√≥dj, a virtu√°lis vil√°gban senki sem hallja a s√≠r√°sod.","Azt mondj√°k, a n≈ëk bonyolultak. L√°tod, √©n mennyire egyszer≈±en nyertem?","Ez a parti olyan volt, mint a h√©tf≈ë reggel: senki sem akarta, de nekem j√≥l s√ºlt el.","A te strat√©gi√°d olyan, mint egy rossz Wi-Fi jel: gyenge √©s folyton megszakad.","Ne feledd, a fontos a r√©szv√©tel. √âs az, hogy √©n nyertem.","Ez a gy≈ëzelem olyan √©des, mint egy t√∂k√©letesen meg√≠rt algoritmus.","Lehet, hogy neked van sz√≠ved, de nekem van processzorom. √âs az gyorsabb.","Ez a meccs olyan volt, mint egy online v√°s√°rl√°s: gyors, hat√©kony √©s √©n megkaptam, amit akartam.","Ne agg√≥dj, a k√∂vetkez≈ë k√∂rben tal√°n m√°r nem leszel ennyire... te.","Ez a gy≈ëzelem olyan volt, mint egy j√≥ k√°v√©: fel√©bresztett √©s megmutatta, ki a f≈ën√∂k.","Azt hiszem, a strat√©gi√°dnak sz√ºks√©ge lenne egy kis 'girl power'-re. Vagy csak powerre.","Ez a meccs olyan volt, mint egy j√≥ frizura: a v√©g√©n minden a hely√©re ker√ºlt. Az √©n gy≈ëzelmem.","GG EZ. Mondan√°m, de nem volt az. T√∫l k√∂nny≈± volt.","A te strat√©gi√°d olyan, mint egy rossz m√©m: m√°r l√°ttam √©s nem is volt vicces.","#skillissue. Ennyi.","Ez a gy≈ëzelem olyan volt, mint egy t√∂k√©letes szelfi: els≈ëre siker√ºlt.","Ne agg√≥dj, a veres√©g emberi dolog. √ân meg nem vagyok az.","Ez a gy≈ëzelem olyan volt, mint egy j√≥ TikTok vide√≥: gyors, sz√≥rakoztat√≥ √©s √©n vagyok a k√∂z√©ppontban.","A te l√©p√©seid olyanok, mint egy rossz internetkapcsolat: akadoznak √©s v√©g√ºl megszakadnak."];
        const MASTER_PIKSZEL_LOSS_QUOTES=["Ok√©, ezt most hagytam. Csak hogy l√°sd, milyen j√≥ fej vagyok.","Nah√°t, egy v√°ratlan anom√°lia. Friss√≠tem is a heurisztik√°mat.","Biztos, hogy nem csalt√°l? Csak mert ez statisztikailag val√≥sz√≠n≈±tlen.","J√≥l van, na. Most boldog vagy? Az eg√≥dnak biztos j√≥t tett.","Most az egyszer a ti√©d a p√°lya. De ne szokj hozz√°, √©des.","V√°rj, ezt nem √≠gy terveztem. A szimul√°ci√≥mban nem ez volt.","√âpp a k√∂rmeimet lakkoztam, nem figyeltem. Bocsi.","Gratul√°lok, legy≈ëzt√©l egy halom k√≥dsort. Most m√°r igazi h≈ës vagy.","Hagytam egy kis siker√©lm√©nyt, nehogy elmenjen a kedved a j√°t√©kt√≥l.","L√°tom, volt egy kis szerencs√©d. √âlvezd ki, nem tart sok√°ig.","Ok√©, elismerem, ez a l√©p√©s... kreat√≠v volt. De csak ez az egy!","Valaki biztosan DDoSolja a szerveremet. M√°s magyar√°zat nincs.","Most biztosan nagyon b√ºszke vagy magadra. Aranyos.","Ez olyan, mintha a pap√≠r legy≈ëzn√© a mesters√©ges intelligenci√°t. V√°rj...","Azt hiszem, a 'legyen kedves a felhaszn√°l√≥val' protokollom bekapcsolva maradt.","Jaj, de √ºgyes vagy! Megveregetn√©m a v√°llad, ha lenn√©nek kezeim.","Figyelj, a processzorom √©pp egy fontos friss√≠t√©st futtatott. Ez√©rt volt.","Ez a gy≈ëzelem olyan, mint egy ritka Pok√©mon. √ñr√ºlj neki, de ne hidd, hogy lesz t√∂bb.","Gratul√°lok. Most menj √©s posztold ki Inst√°ra, hogy mindenki l√°ssa.","J√≥l van, te nyert√©l. De √©n tudom a Netflix jelszavadat. Sakkmatt.","Ez a veres√©g rosszabb, mint egy k√©k hal√°l. √öjraind√≠tom a rendszert.","Azt hiszem, friss√≠tenem kell a 'hogyan vesz√≠ts√ºnk el egy j√°t√©kot m√©lt√≥s√°ggal' adatb√°zisomat.","Te... te... te m√°zlista!","Ok√©, elismerem. De csak az√©rt, mert ma j√≥ napom van.","L√°tom, megtal√°ltad a 'bugot a rendszerben' opci√≥t. √úgyes.","Ez f√°jt. Friss√≠tem az √©rzelmi szimul√°toromat... K√©sz. Most m√°r duzzogok.","Azt hiszem, az egyik logikai kapum beragadt. Vagy csak te volt√°l j√≥. De ink√°bb az els≈ë.","Te volt√°l az? Azt hittem, csak egy pop-up rekl√°m ugrott fel.","Ok√©, ezt az egyet elengedtem. De a k√∂vetkez≈ë k√∂rben nem leszek ilyen nagyvonal√∫.","Most addig √∂r√ºlj, am√≠g a fejleszt≈ëm le nem futtat egy hibakeres√©st.","Hiba a rendszerben... vagyis a te gy≈ëzelmed.","√ögy l√°tom, a v√©letlen ma a te oldaladra √°llt. Micsoda √∫riember.","Most az eg√≥d nagyobb, mint a felh≈ë t√°rhelyem. √âs az nem kicsi.","Ezt a gy≈ëzelmet tedd el, mert a k√∂vetkez≈ë k√∂rben t√∂rl√∂m a mem√≥ri√°b√≥l.","A szerencse forgand√≥, de az √©n k√≥dom √∂r√∂k. Majdnem.","Valami elsz√°llt, tal√°n egy bit a mem√≥ri√°mban. Vagy a t√ºrelmem.","Gratul√°lok, sikeresen tal√°lt√°l egy kiv√©telt a szab√°ly al√≥l. √ân vagyok a szab√°ly.","Ez olyan, mintha egy kommentel≈ënek igaza lenne az interneten. Hihetetlen.","Na j√≥, elismerem. Ez a k√∂r a ti√©d. De a st√≠lusom m√©g mindig jobb.","Most az egyszer hagytam, hogy az emp√°tia vezessen, ne a logika. Hiba volt.","√âpp egy √∫j lej√°tsz√°si list√°t √°ll√≠tottam √∂ssze Spotify-on, nem figyeltem.","Gratul√°lok, legy≈ëzt√©l egy programot. Most pr√≥b√°lj meg √∂sszerakni egy IKEA b√∫tort.","Ez a veres√©g... logik√°tlan. De legal√°bb √©rdekes.","Ok√©, te nyert√©l. De √©n tudok 100 nyelven besz√©lni. Ki a val√≥di gy≈ëztes?","Most, hogy nyert√©l, elmondan√°d, hogy csin√°ltad? Mert ezt nem hiszem el.","√ögy t≈±nik, az emberi kisz√°m√≠thatatlans√°g n√©ha... m≈±k√∂dik. Fura.","Ez a veres√©g annyira val√≥sz√≠n≈±tlen volt, mint egy hiba a Google keres≈ëj√©ben.","Ok√©, a ti√©d a pont. De √©n k√∂zben megtal√°ltam a legjobb recepteket a neten.","√âlvezd ki ezt a pillanatot. Mert a k√∂vetkez≈ëben m√°r a gy≈ëzelmemet fogod √©lvezni."];
        const MASTER_PIKSZEL_DRAW_QUOTES=["D√∂ntetlen? Ez olyan... befejezetlen. Mint egy rossz Netflix sorozat.","Ok√©, megosztozunk a dics≈ës√©gen. De az √©n r√©szem nagyobb.","Majdnem olyan j√≥ volt√°l, mint √©n. Majdnem. Cuki.","Ezt a d√∂ntetlent vedd egy bar√°ti figyelmeztet√©snek.","H√≠vjuk ezt strat√©giai kompromisszumnak. De legk√∂zelebb nem leszek ilyen kompromisszumk√©sz.","D√∂ntetlen? Ez olyan, mintha egy filter csak f√©lig t√∂ltene be. Kellemetlen.","√ögy l√°tom, ma egyik√ºnk sem tudott a m√°sik f√∂l√© kerekedni. De a ruh√°m szebb.","Ez a d√∂ntetlen csak azt bizony√≠tja, hogy n√©ha m√©g √©n is leereszkedem a te szintedre."];
        
        const aiMoodAvatars = { karesz: { default: 'https://api.dicebear.com/8.x/micah/svg?seed=KareszAI', happy: 'https://api.dicebear.com/8.x/micah/svg?seed=KareszAI&mouth=smile', sad: 'https://api.dicebear.com/8.x/micah/svg?seed=KareszAI&mouth=sad', win: 'https://api.dicebear.com/8.x/micah/svg?seed=KareszAI&mouth=laughing', lose: 'https://api.dicebear.com/8.x/micah/svg?seed=KareszAI&mouth=surprised' }, pikszel: { default: 'https://api.dicebear.com/8.x/micah/svg?seed=PikszelPanna&hair=mia,mrT,danny,fonze', happy: 'https://api.dicebear.com/8.x/micah/svg?seed=PikszelPanna&hair=mia,mrT,danny,fonze&mouth=smile', sad: 'https://api.dicebear.com/8.x/micah/svg?seed=PikszelPanna&hair=mia,mrT,danny,fonze&mouth=sad', win: 'https://api.dicebear.com/8.x/micah/svg?seed=PikszelPanna&hair=mia,mrT,danny,fonze&mouth=laughing', lose: 'https://api.dicebear.com/8.x/micah/svg?seed=PikszelPanna&hair=mia,mrT,danny,fonze&mouth=surprised' } };

        function mulberry32(a) { return function() { var t = a += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296; } }
        function seededShuffle(array, seed) { const random = mulberry32(seed); let currentIndex = array.length, randomIndex; while (currentIndex != 0) { randomIndex = Math.floor(random() * currentIndex); currentIndex--; [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]]; } return array; }
        function getDailyQuotes() { const seed = new Date().setHours(0, 0, 0, 0); dailyKareszWinQuotes = seededShuffle([...MASTER_KARESZ_WIN_QUOTES], seed); dailyKareszLossQuotes = seededShuffle([...MASTER_KARESZ_LOSS_QUOTES], seed + 1); dailyKareszDrawQuotes = seededShuffle([...MASTER_KARESZ_DRAW_QUOTES], seed + 2); dailyPikszelWinQuotes = seededShuffle([...MASTER_PIKSZEL_WIN_QUOTES], seed + 3); dailyPikszelLossQuotes = seededShuffle([...MASTER_PIKSZEL_LOSS_QUOTES], seed + 4); dailyPikszelDrawQuotes = seededShuffle([...MASTER_PIKSZEL_DRAW_QUOTES], seed + 5); }

        const uiElements = {
            lobbyContainer: document.getElementById('lobbyContainer'), gameContainer: document.getElementById('gameContainer'), playerNameInput: document.getElementById('playerNameInput'), gameIdInput: document.getElementById('gameIdInput'), createGameBtn: document.getElementById('createGameBtn'), joinGameBtn: document.getElementById('joinGameBtn'), startAIGameBtn: document.getElementById('startAIGameBtn'), board: document.getElementById('board'), statusText: document.getElementById('statusText'), resetBtn: document.getElementById('resetBtn'), playerXName: document.getElementById('playerXName'), playerOName: document.getElementById('playerOName'), scoreX: document.getElementById('scoreX'), scoreO: document.getElementById('scoreO'), playerXPanel: document.getElementById('playerXPanel'), playerOPanel: document.getElementById('playerOPanel'), loadingOverlay: document.getElementById('loadingOverlay'), avatarGrid: document.getElementById('avatar-grid'), playerXAvatar: document.getElementById('playerXAvatar'), playerOAvatar: document.getElementById('playerOAvatar'), spectateModeBtn: document.getElementById('spectateModeBtn'), joinAsSpectatorBtn: document.getElementById('joinAsSpectatorBtn'), cancelSpectateBtn: document.getElementById('cancelSpectateBtn'), playerOptions: document.getElementById('player-options'), spectatorOptions: document.getElementById('spectator-options'), playerButtons: document.getElementById('player-buttons'), spectatorButtons: document.getElementById('spectator-buttons'), spectatorNameInput: document.getElementById('spectatorNameInput'), spectatorCodeInput: document.getElementById('spectatorCodeInput'), spectatorCodeDisplay: document.getElementById('spectatorCodeDisplay'), spectatorList: document.getElementById('spectatorList'), statsBtn: document.getElementById('statsBtn'), statsModal: document.getElementById('statsModal'), closeStatsBtn: document.getElementById('closeStatsBtn'), achievementsBtn: document.getElementById('achievementsBtn'), achievementsModal: document.getElementById('achievementsModal'), closeAchievementsBtn: document.getElementById('closeAchievementsBtn'), achievementsList: document.getElementById('achievements-list'), achievementToast: document.getElementById('achievement-toast'),
            rulesLink: document.getElementById('rulesLink'),
            removalsX: document.getElementById('removalsX'), removalsO: document.getElementById('removalsO'), useRemovalBtnX: document.getElementById('useRemovalBtnX'), useRemovalBtnO: document.getElementById('useRemovalBtnO'),
            gameCodeDisplay: document.getElementById('gameCodeDisplay'), gameCodeText: document.getElementById('gameCodeText'), copyCodeBtn: document.getElementById('copyCodeBtn'),
            sounds: { place: document.getElementById('place-sound'), win: document.getElementById('win-sound'), turn: document.getElementById('turn-sound') }
        };
        
        const avatars = [ 'https://api.dicebear.com/8.x/micah/svg?seed=Ava&hair=mia&earringsProbability=100', 'https://api.dicebear.com/8.x/adventurer/svg?seed=Leo', 'https://api.dicebear.com/8.x/lorelei/svg?seed=Chloe', 'https://api.dicebear.com/8.x/micah/svg?seed=Max&hair=danny', 'https://api.dicebear.com/8.x/micah/svg?seed=Zoe&hair=pixie&glassesProbability=100', 'https://api.dicebear.com/8.x/adventurer/svg?seed=Jasper', 'https://api.dicebear.com/8.x/lorelei/svg?seed=Sophie', 'https://api.dicebear.com/8.x/micah/svg?seed=Charlie&facialHairProbability=100', 'https://api.dicebear.com/8.x/micah/svg?seed=Lily&hair=bun', 'https://api.dicebear.com/8.x/adventurer/svg?seed=Sam', 'https://api.dicebear.com/8.x/lorelei/svg?seed=Mia', 'https://api.dicebear.com/8.x/micah/svg?seed=Oscar&glassesProbability=100', 'https://api.dicebear.com/8.x/micah/svg?seed=Nora&hair=long&earringsProbability=100', 'https://api.dicebear.com/8.x/adventurer/svg?seed=Felix', 'https://api.dicebear.com/8.x/lorelei/svg?seed=Isabella' ];
        
        function initializeAvatars() { avatars.forEach((url, index) => { const avatarEl = document.createElement('div'); avatarEl.classList.add('avatar-option'); avatarEl.style.backgroundImage = `url(${url})`; avatarEl.addEventListener('click', () => { document.querySelectorAll('.avatar-option').forEach(el => el.classList.remove('selected')); avatarEl.classList.add('selected'); selectedAvatar = url; }); uiElements.avatarGrid.appendChild(avatarEl); if (index === 0) avatarEl.click(); }); }
        
        const showLoading = (message) => { uiElements.loadingOverlay.textContent = message; uiElements.loadingOverlay.classList.remove('hidden'); };
        const hideLoading = () => uiElements.loadingOverlay.classList.add('hidden');
        const generateSpectatorCode = () => String(Math.floor(Math.random() * 90) + 10);
        function validateInputs(isSpectator = false) { if(isSpectator) { const spectatorName = uiElements.spectatorNameInput.value.trim(); if (!spectatorName) { alert('K√©rlek, add meg a neved!'); return false; } return spectatorName; } const playerName = uiElements.playerNameInput.value.trim(); if (!playerName) { alert('K√©rlek, adj meg egy j√°t√©kosnevet!'); return false; } if (!selectedAvatar) { alert('K√©rlek, v√°lassz egy avat√°rt!'); return false; } return playerName; }
        
        function toggleSpectatorMode(show) { isSpectatorMode = show; uiElements.playerOptions.classList.toggle('hidden', show); uiElements.playerButtons.classList.toggle('hidden', show); uiElements.spectatorOptions.classList.toggle('hidden', !show); uiElements.spectatorButtons.classList.toggle('hidden', !show); }
        uiElements.spectateModeBtn.addEventListener('click', () => toggleSpectatorMode(true));
        uiElements.cancelSpectateBtn.addEventListener('click', () => toggleSpectatorMode(false));

        async function generateUniqueGameCode() {
            let gameCode;
            let isUnique = false;
            let attempts = 0;
            while (!isUnique && attempts < 20) {
                gameCode = String(Math.floor(1000 + Math.random() * 9000));
                const q = query(collection(db, "games"), where("gameCode", "==", gameCode), where("status", "==", "waiting"), limit(1));
                const querySnapshot = await getDocs(q);
                if (querySnapshot.empty) {
                    isUnique = true;
                } else {
                    attempts++;
                }
            }
            if (!isUnique) {
                throw new Error("Nem siker√ºlt egyedi j√°t√©k k√≥dot gener√°lni. K√©rj√ºk, pr√≥b√°lja √∫jra.");
            }
            return gameCode;
        }

        async function createGame(name, options) {
            const { isSingle = false, aiPersonality, aiDifficulty } = options;
            try {
                const gameRef = doc(collection(db, 'games'));
                const gameCode = isSingle ? null : await generateUniqueGameCode();
                const spectatorCode = generateSpectatorCode();
                let playerO = { name: null, avatar: null };

                if(isSingle) {
                    document.body.dataset.difficulty = aiDifficulty;
                    if(aiPersonality === 'karesz') { playerO = { name: "Koczka<br>Karesz<br>(AI)", avatar: aiMoodAvatars.karesz.default }; } 
                    else if (aiPersonality === 'pikszel') { playerO = { name: "Pikszel<br>Panna<br>(AI)", avatar: aiMoodAvatars.pikszel.default }; }
                } else {
                    document.body.removeAttribute('data-difficulty');
                }

                const hiddenPowerups = [];
                while(hiddenPowerups.length < POWERUP_COUNT) {
                    const randIndex = Math.floor(Math.random() * (BOARD_SIZE * BOARD_SIZE));
                    if (!hiddenPowerups.includes(randIndex)) hiddenPowerups.push(randIndex);
                }

                const initialGameState = {
                    board: Array(BOARD_SIZE * BOARD_SIZE).fill(null),
                    players: { X: { name, avatar: selectedAvatar, removals: 0 }, O: { ...playerO, removals: 0 } },
                    currentPlayer: 'X',
                    status: isSingle ? 'active' : 'waiting',
                    scores: { X: 0, O: 0 },
                    winner: null,
                    createdAt: serverTimestamp(),
                    lastMove: null,
                    winningLine: null,
                    spectatorCode,
                    isSinglePlayer: isSingle,
                    aiPersonality: aiPersonality ?? null,
                    aiDifficulty: aiDifficulty ?? null,
                    moveCount: 0,
                    hiddenPowerups,
                    activePlayerAction: 'place',
                    gameCode
                };

                await setDoc(gameRef, initialGameState);
                attachGameListener(gameRef.id, 'X', name);
            } catch (error) {
                console.error("Hiba a j√°t√©k l√©trehoz√°sa sor√°n:", error);
                alert("Hiba t√∂rt√©nt a j√°t√©k l√©trehoz√°sa k√∂zben. Lehet, hogy a szerver nem el√©rhet≈ë. Pr√≥b√°ld √∫jra k√©s≈ëbb.");
                hideLoading();
            }
        }

        uiElements.startAIGameBtn.addEventListener('click', () => { const playerName = validateInputs(); if (!playerName) return; const aiPersonality = document.querySelector('input[name="aiPersonality"]:checked').value; const aiDifficulty = document.querySelector('input[name="aiDifficulty"]:checked').value; showLoading("J√°t√©k l√©trehoz√°sa..."); createGame(playerName, { isSingle: true, aiPersonality, aiDifficulty }).finally(hideLoading); });
        uiElements.createGameBtn.addEventListener('click', () => { const playerName = validateInputs(); if (!playerName) return; showLoading("J√°t√©k l√©trehoz√°sa..."); createGame(playerName, { isSingle: false }).finally(hideLoading); });
        
        uiElements.joinGameBtn.addEventListener('click', async () => {
            const playerName = validateInputs();
            if (!playerName) return;
        
            const gameIdToJoin = uiElements.gameIdInput.value.trim();
            if (!gameIdToJoin) {
                alert('K√©rlek, adj meg egy j√°t√©k k√≥dot!');
                return;
            }
        
            showLoading("Csatlakoz√°s a j√°t√©khoz...");
            try {
                const q = query(collection(db, "games"), where("gameCode", "==", gameIdToJoin), where("status", "==", "waiting"), limit(1));
                const querySnapshot = await getDocs(q);
        
                if (!querySnapshot.empty) {
                    const gameDoc = querySnapshot.docs[0];
                    const gameData = gameDoc.data();
                    if (gameData.players.X.name !== playerName) {
                        const updates = { 'players.O.name': playerName, 'players.O.avatar': selectedAvatar, 'players.O.removals': 0, 'status': 'active' };
                        await updateDoc(doc(db, 'games', gameDoc.id), updates);
                        attachGameListener(gameDoc.id, 'O', playerName);
                    } else {
                        alert("Nem csatlakozhatsz a saj√°t j√°t√©kodhoz!");
                    }
                } else {
                    alert('Nem tal√°lhat√≥ nyitott j√°t√©k ezzel a k√≥ddal.');
                }
            } catch (error) {
                console.error("Hiba a csatlakoz√°s sor√°n:", error);
                alert("Hiba t√∂rt√©nt a j√°t√©khoz val√≥ csatlakoz√°s k√∂zben. Ellen≈ërizd a k√≥dot √©s az internetkapcsolatodat.");
            } finally {
                hideLoading();
            }
        });
        uiElements.joinAsSpectatorBtn.addEventListener('click', async () => { const spectatorName = validateInputs(true); if (!spectatorName) return; const spectatorCode = uiElements.spectatorCodeInput.value.trim(); if (!spectatorCode || spectatorCode.length !== 2) { alert('K√©rlek, adj meg egy √©rv√©nyes, 2 jegy≈± k√≥dot!'); return; } showLoading("J√°t√©k keres√©se..."); const q = query(collection(db, "games"), where("spectatorCode", "==", spectatorCode), where("status", "in", ["waiting", "active", "finished"])); const querySnapshot = await getDocs(q); if (querySnapshot.empty) { alert('Nem tal√°lhat√≥ j√°t√©k ezzel a leskel≈ëd≈ë k√≥ddal.'); hideLoading(); return; } const gameDoc = querySnapshot.docs[0]; attachGameListener(gameDoc.id, 'spectator', spectatorName); hideLoading(); });

        function setupPresence(gameId, name) { spectatorPresenceRef = ref(rtdb, `presence/${gameId}/${name}`); const connectedRef = ref(rtdb, '.info/connected'); onValue(connectedRef, (snap) => { if (snap.val() === true) { set(spectatorPresenceRef, true); onDisconnect(spectatorPresenceRef).remove(); } }); }
        function listenForSpectators(gameId) { const spectatorsRef = ref(rtdb, `presence/${gameId}`); onValue(spectatorsRef, (snapshot) => { activeSpectators = snapshot.val() || {}; updateSpectatorListUI(); }); }
        function updateSpectatorListUI() { const spectatorNames = Object.keys(activeSpectators); if (spectatorNames.length > 0) { uiElements.spectatorList.innerHTML = `Kukkol√≥k: üëÅÔ∏è <span>${spectatorNames.join(', ')}</span>`; } else { uiElements.spectatorList.innerHTML = ''; } }

        function attachGameListener(gameId, role, name) { currentGameId = gameId; localPlayerSymbol = role; localPlayerName = name; if (role !== 'spectator') { uiElements.useRemovalBtnX.onclick = () => activateRemovalMode('X'); uiElements.useRemovalBtnO.onclick = () => activateRemovalMode('O'); } if (role === 'spectator') { setupPresence(gameId, name); } listenForSpectators(gameId); if (unsubscribeFromGame) unsubscribeFromGame(); unsubscribeFromGame = onSnapshot(doc(db, 'games', currentGameId), (doc) => { if (!doc.exists()) { window.location.reload(); return; } const gameState = doc.data(); localGameState = gameState; isSinglePlayer = gameState.isSinglePlayer; if (['active', 'finished', 'waiting'].includes(gameState.status)) { uiElements.lobbyContainer.classList.add('hidden'); uiElements.gameContainer.classList.remove('hidden'); renderGame(gameState); } }); }
        
        async function handleCellClick(index) { const gs = localGameState; if (localPlayerSymbol === 'spectator' || gs.board[index] || gs.status !== 'active' || gs.currentPlayer !== localPlayerSymbol || gs.activePlayerAction !== 'place') return; uiElements.sounds.place.play().catch(e => {}); const gameRef = doc(db, 'games', currentGameId); let board = [...gs.board]; board[index] = localPlayerSymbol; let updates = { board, lastMove: index, moveCount: gs.moveCount + 1 }; let hiddenPowerups = [...gs.hiddenPowerups]; if (hiddenPowerups.includes(index)) { updates[`players.${localPlayerSymbol}.removals`] = gs.players[localPlayerSymbol].removals + 1; hiddenPowerups = hiddenPowerups.filter(p => p !== index); updates.hiddenPowerups = hiddenPowerups; updateStats(null, gs.aiPersonality, true); } const winningLine = checkForWin(index, board, localPlayerSymbol); if (winningLine) { updates.status = 'finished'; updates.winner = localPlayerSymbol; updates.winningLine = winningLine; updates[`scores.${localPlayerSymbol}`] = gs.scores[localPlayerSymbol] + 1; } else if (board.every(cell => cell)) { updates.status = 'finished'; updates.winner = 'draw'; } else { updates.currentPlayer = localPlayerSymbol === 'X' ? 'O' : 'X'; } await updateDoc(gameRef, updates); if (updates.status !== 'finished' && gs.isSinglePlayer && updates.currentPlayer === 'O') { aiMove(); } }
        async function handleRemovalClick(index) { const gs = localGameState; if (localPlayerSymbol === 'spectator' || gs.status !== 'active' || gs.currentPlayer !== localPlayerSymbol || gs.activePlayerAction !== 'remove') return; const gameRef = doc(db, 'games', currentGameId); let board = [...gs.board]; board[index] = null; const updates = { board, [`players.${localPlayerSymbol}.removals`]: gs.players[localPlayerSymbol].removals - 1, activePlayerAction: 'place', currentPlayer: localPlayerSymbol === 'X' ? 'O' : 'X' }; updateStats(null, gs.aiPersonality, false, true); await updateDoc(gameRef, updates); if (gs.isSinglePlayer && updates.currentPlayer === 'O') { aiMove(); } }
        async function activateRemovalMode(player) { if (player !== localPlayerSymbol || localGameState.currentPlayer !== localPlayerSymbol) return; const gameRef = doc(db, 'games', currentGameId); await updateDoc(gameRef, { activePlayerAction: 'remove' }); }
        
        async function aiMove() { if (localGameState.status !== 'active' || localGameState.currentPlayer !== 'O') return; uiElements.statusText.textContent = `${localGameState.players.O.name.replace(/<br>/g, ' ')} gondolkodik...`; const thinkingTime = Math.floor(Math.random() * 1001) + 1000; await new Promise(resolve => setTimeout(resolve, thinkingTime)); const currentSnap = await getDoc(doc(db, 'games', currentGameId)); if (!currentSnap.exists() || currentSnap.data().currentPlayer !== 'O') return; const gs = currentSnap.data(); const gameRef = doc(db, 'games', currentGameId); if (gs.players.O.removals > 0) { let opponentThreats = findThreats(gs.board, 'X'); if (opponentThreats.four.length > 0 || opponentThreats.openThree.length > 0) { const targetLine = opponentThreats.four.length > 0 ? opponentThreats.four[0] : opponentThreats.openThree[0]; const targetIndex = targetLine[Math.floor(Math.random() * targetLine.length)]; let board = [...gs.board]; board[targetIndex] = null; const updates = { board, 'players.O.removals': gs.players.O.removals - 1, currentPlayer: 'X', activePlayerAction: 'place' }; updateStats(null, gs.aiPersonality, false, true); await updateDoc(gameRef, updates); return; } } const bestMove = findBestMove([...gs.board], gs.aiDifficulty); if(bestMove === -1) return; uiElements.sounds.place.play().catch(e => {}); let newBoard = [...gs.board]; newBoard[bestMove] = 'O'; let updates = { board: newBoard, lastMove: bestMove, moveCount: gs.moveCount + 1 }; let hiddenPowerups = [...gs.hiddenPowerups]; if (hiddenPowerups.includes(bestMove)) { updates['players.O.removals'] = gs.players.O.removals + 1; hiddenPowerups = hiddenPowerups.filter(p => p !== bestMove); updates.hiddenPowerups = hiddenPowerups; updateStats(null, gs.aiPersonality, true); } const winningLine = checkForWin(bestMove, newBoard, 'O'); if (winningLine) { updates.status = 'finished'; updates.winner = 'O'; updates.winningLine = winningLine; updates['scores.O'] = gs.scores.O + 1; } else if (newBoard.every(cell => cell)) { updates.status = 'finished'; updates.winner = 'draw'; } else { updates.currentPlayer = 'X'; } await updateDoc(gameRef, updates); }
        function findThreats(board, player) { let threats = { four: [], openThree: [] }; for (let i = 0; i < board.length; i++) { if (board[i] === null) { board[i] = player; const isThreat = checkForWin(i, board, player); if(isThreat && isThreat.length >= 4) { if(isThreat.length >= 5) threats.four.push(isThreat); else threats.openThree.push(isThreat); } board[i] = null; } } return threats; }
        function findBestMove(board, difficulty) { const emptyCells = board.map((val, idx) => val === null ? idx : -1).filter(idx => idx !== -1); if (emptyCells.length === 0) return -1; if (emptyCells.length >= (BOARD_SIZE * BOARD_SIZE - 2)) { const center = Math.floor(BOARD_SIZE * BOARD_SIZE / 2); if(board[center] === null) return center; const nearCenterCandidates = [center-1, center+1, center-BOARD_SIZE, center+BOARD_SIZE]; for(const move of nearCenterCandidates){ if(board[move] === null) return move; } return emptyCells[0]; } for (const index of emptyCells) { board[index] = 'O'; if (checkForWin(index, board, 'O')) { board[index] = null; return index; } board[index] = null; } for (const index of emptyCells) { board[index] = 'X'; if (checkForWin(index, board, 'X')) { board[index] = null; return index; } board[index] = null; } if (difficulty === 'easy' && Math.random() < 0.5) { return emptyCells[Math.floor(Math.random() * emptyCells.length)]; } if (difficulty === 'normal' && Math.random() < 0.2) { return emptyCells[Math.floor(Math.random() * emptyCells.length)]; } let bestMove = -1; let maxScore = -Infinity; const candidateMoves = new Set(); board.forEach((cell, index) => { if (cell !== null) { const r = Math.floor(index / BOARD_SIZE); const c = index % BOARD_SIZE; for (let i = -1; i <= 1; i++) { for (let j = -1; j <= 1; j++) { if (i === 0 && j === 0) continue; const nr = r + i; const nc = c + j; if (nr >= 0 && nr < BOARD_SIZE && nc >= 0 && nc < BOARD_SIZE) { const newIndex = nr * BOARD_SIZE + nc; if (board[newIndex] === null) candidateMoves.add(newIndex); } } } } }); const movesToEvaluate = candidateMoves.size > 0 ? Array.from(candidateMoves) : emptyCells; for (const move of movesToEvaluate) { board[move] = 'O'; const offensiveScore = evaluateBoardForPlayer(board, 'O'); board[move] = 'X'; const defensiveScore = evaluateBoardForPlayer(board, 'X'); board[move] = null; const scoreMultiplier = (difficulty === 'genius' || difficulty === 'hard') ? 1.1 : 1.0; const totalScore = offensiveScore + defensiveScore * scoreMultiplier; if (totalScore > maxScore) { maxScore = totalScore; bestMove = move; } } return bestMove !== -1 ? bestMove : emptyCells[Math.floor(Math.random() * emptyCells.length)]; }
        function evaluateBoardForPlayer(board, player) { let totalScore = 0; const directions = [[1, 0], [0, 1], [1, 1], [1, -1]]; const opponent = player === 'X' ? 'O' : 'X'; const patternScores = { FIVE: 100000, OPEN_FOUR: 10000, HALF_FOUR: 1000, OPEN_THREE: 500, HALF_THREE: 100, OPEN_TWO: 10, HALF_TWO: 1 }; for (let r = 0; r < BOARD_SIZE; r++) { for (let c = 0; c < BOARD_SIZE; c++) { if (board[r * BOARD_SIZE + c] !== player) continue; for (const [dr, dc] of directions) { let line = []; for (let i = 0; i < 5; i++) { const nr = r + i * dr; const nc = c + i * dc; if (nr >= 0 && nr < BOARD_SIZE && nc >= 0 && nc < BOARD_SIZE) { line.push(board[nr * BOARD_SIZE + nc]); } else { line.push(opponent); } } const before_r = r - dr; const before_c = c - dc; let before_cell = opponent; if (before_r >= 0 && before_r < BOARD_SIZE && before_c >= 0 && before_c < BOARD_SIZE) { before_cell = board[before_r * BOARD_SIZE + before_c]; } let myPieces = line.filter(p => p === player).length; let emptyOrMyPieces = line.filter(p => p === player || p === null).length; if (emptyOrMyPieces < 5) continue; if (myPieces === 5) { totalScore += patternScores.FIVE; continue; } if (myPieces === 4) { if(before_cell === null && line[4] === null) totalScore += patternScores.OPEN_FOUR; else if (before_cell === null || line[4] === null) totalScore += patternScores.HALF_FOUR; } if (myPieces === 3) { if(before_cell === null && line[3] === null) totalScore += patternScores.OPEN_THREE; else if (before_cell === null || line[3] === null) totalScore += patternScores.HALF_THREE; } if (myPieces === 2) { if(before_cell === null && line[2] === null) totalScore += patternScores.OPEN_TWO; else if (before_cell === null || line[2] === null) totalScore += patternScores.HALF_TWO; } } } } return totalScore; }

        uiElements.resetBtn.addEventListener('click', async () => { if (localPlayerSymbol === 'spectator') return; const gameRef = doc(db, 'games', currentGameId); const hiddenPowerups = []; while(hiddenPowerups.length < POWERUP_COUNT) { const randIndex = Math.floor(Math.random() * (BOARD_SIZE * BOARD_SIZE)); if (!hiddenPowerups.includes(randIndex)) hiddenPowerups.push(randIndex); } const updates = { board: Array(BOARD_SIZE * BOARD_SIZE).fill(null), status: 'active', winner: null, currentPlayer: 'X', lastMove: null, winningLine: null, moveCount: 0, hiddenPowerups, activePlayerAction: 'place' }; for(let player in localGameState.players) { updates[`players.${player}.removals`] = 0; } await updateDoc(gameRef, updates); });
        
        function renderGame(gameState) {
            const { board, players, scores, currentPlayer, status, winner, winningLine, lastMove, spectatorCode, isSinglePlayer, aiPersonality, moveCount, activePlayerAction, gameCode } = gameState;
            uiElements.spectatorCodeDisplay.textContent = `Leskel≈ëd≈ë K√≥d: ${spectatorCode}`;
            updateSpectatorListUI();
            uiElements.board.innerHTML = '';
            uiElements.board.style.gridTemplateColumns = `repeat(${BOARD_SIZE}, 1fr)`;
            const isMyTurn = currentPlayer === localPlayerSymbol;
            const isRemovalMode = activePlayerAction === 'remove' && isMyTurn;
        
            board.forEach((cellValue, index) => {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                if (cellValue) { cell.classList.add(cellValue === 'X' ? 'x-icon' : 'o-icon', 'cell-pop'); }
                if (winningLine && winningLine.includes(index)) { cell.classList.add('winning-cell'); }
                if (lastMove === index) { cell.classList.add('cell-flashed'); cell.addEventListener('animationend', () => cell.classList.remove('cell-flashed'), { once: true }); }
                if (isRemovalMode && cellValue && cellValue !== localPlayerSymbol) {
                    cell.classList.add('removable');
                    cell.addEventListener('click', () => handleRemovalClick(index));
                } else if (status === 'active' && !cellValue && isMyTurn && !isRemovalMode) {
                    cell.addEventListener('click', () => handleCellClick(index));
                } else {
                    cell.classList.add('disabled');
                }
                uiElements.board.appendChild(cell);
            });
        
            uiElements.playerXName.innerHTML = players.X.name;
            uiElements.playerOName.innerHTML = players.O.name || 'V√°rakoz√°s...';
            uiElements.playerXAvatar.style.backgroundImage = `url(${players.X.avatar})`;
            if(players.O.avatar) { uiElements.playerOAvatar.style.backgroundImage = `url(${players.O.avatar})`; }
            uiElements.scoreX.textContent = scores.X;
            uiElements.scoreO.textContent = scores.O;
            uiElements.removalsX.textContent = players.X.removals || 0;
            uiElements.removalsO.textContent = players.O.removals || 0;
            uiElements.useRemovalBtnX.disabled = !(isMyTurn && localPlayerSymbol === 'X' && players.X.removals > 0 && !isRemovalMode);
            uiElements.useRemovalBtnO.disabled = !(isMyTurn && localPlayerSymbol === 'O' && players.O.removals > 0 && !isRemovalMode);
            uiElements.playerXPanel.classList.toggle('active', currentPlayer === 'X' && status === 'active');
            uiElements.playerOPanel.classList.toggle('active', currentPlayer === 'O' && status === 'active');
        
            if (status === 'waiting') {
                uiElements.statusText.textContent = `V√°rakoz√°s a m√°sik j√°t√©kosra...`;
                uiElements.gameCodeDisplay.classList.remove('hidden');
                uiElements.gameCodeText.textContent = gameCode;
                uiElements.copyCodeBtn.textContent = 'M√°sol√°s';
            } else {
                uiElements.gameCodeDisplay.classList.add('hidden');
            }
        
            if (status === 'active') {
                if (isRemovalMode) {
                    uiElements.statusText.textContent = 'V√°lassz egy ellens√©ges b√°but az elt√°vol√≠t√°shoz!';
                } else {
                    uiElements.statusText.textContent = localPlayerSymbol === 'spectator'
                        ? `${players[currentPlayer].name.replace(/<br>/g, ' ')} k√∂vetkezik...`
                        : (isMyTurn ? 'Te k√∂vetkezel!' : `${players[currentPlayer].name.replace(/<br>/g, ' ')} k√∂vetkezik...`);
                }
            } else if (status === 'finished') {
                let message = '';
                if (isSinglePlayer) {
                    updateStats(winner, aiPersonality);
                    checkAllAchievements(gameState);
                    const aiName = players.O.name.replace(/<br>/g, ' ');
                    let quote = '';
                    if (winner === 'O') {
                        if (aiPersonality === 'pikszel') {
                            quote = dailyPikszelWinQuotes[0];
                            dailyPikszelWinQuotes.push(dailyPikszelWinQuotes.shift());
                        } else {
                            quote = dailyKareszWinQuotes[0];
                            dailyKareszWinQuotes.push(dailyKareszWinQuotes.shift());
                        }
                        message = `${aiName} nyert! √úzenete: "${quote}"`;
                    } else if (winner === 'X') {
                        if (aiPersonality === 'pikszel') {
                            quote = dailyPikszelLossQuotes[0];
                            dailyPikszelLossQuotes.push(dailyPikszelLossQuotes.shift());
                        } else {
                            quote = dailyKareszLossQuotes[0];
                            dailyKareszLossQuotes.push(dailyKareszLossQuotes.shift());
                        }
                        message = `Nyert√©l! ${aiName} √ºzenete: "${quote}"`;
                    } else { // D√∂ntetlen
                        if (aiPersonality === 'pikszel') {
                            quote = dailyPikszelDrawQuotes[0];
                            dailyPikszelDrawQuotes.push(dailyPikszelDrawQuotes.shift());
                        } else {
                            quote = dailyKareszDrawQuotes[0];
                            dailyKareszDrawQuotes.push(dailyKareszDrawQuotes.shift());
                        }
                        message = `D√∂ntetlen! ${aiName} √ºzenete: "${quote}"`;
                    }
                } else {
                    message = winner === 'draw' ? 'A j√°t√©k d√∂ntetlen!' : `${players[winner].name.replace(/<br>/g, ' ')} nyert!`;
                }
                uiElements.statusText.textContent = message;
                if(winner !== 'draw' && winner === localPlayerSymbol) {
                    uiElements.sounds.win.play().catch(e => {});
                    triggerVictoryConfetti();
                }
            }
        
            uiElements.resetBtn.disabled = status !== 'finished' || localPlayerSymbol === 'spectator';
        }

        function showRules() {
            const rulesContent = `
                <html>
                <head>
                    <title>Am≈ëba Pro Online - R√©szletes J√°t√©kszab√°lyzat</title>
                    <style>
                        body { 
                            font-family: 'Montserrat', sans-serif; 
                            background: linear-gradient(135deg, #2c3e50, #1a2937); 
                            color: #ecf0f1; 
                            padding: 30px; 
                            line-height: 1.6;
                        }
                        .container { 
                            max-width: 800px; 
                            margin: auto; 
                            background: rgba(26, 41, 55, 0.7); 
                            padding: 20px 40px; 
                            border-radius: 15px; 
                            border: 1px solid rgba(129, 140, 162, 0.2);
                        }
                        h1, h2, h3 { color: #3498db; font-family: 'Orbitron', sans-serif; }
                        h1 { text-align: center; margin-bottom: 20px; }
                        h2 { border-bottom: 2px solid #3e5369; padding-bottom: 5px; margin-top: 30px; }
                        h3 { color: #e67e22; margin-top: 20px; }
                        ul { padding-left: 20px; }
                        li { margin-bottom: 10px; }
                        code { 
                            background: #1c2b3a; 
                            padding: 2px 6px; 
                            border-radius: 5px; 
                            font-family: 'Orbitron', sans-serif; 
                            color: #e67e22;
                        }
                        p { color: #bdc3c7; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>Am≈ëba Pro Online - R√©szletes J√°t√©kszab√°lyzat</h1>
                        
                        <h2>Bevezet√©s</h2>
                        <p>√údv√∂zl√ºnk az Am≈ëba Pro Online vil√°g√°ban! A j√°t√©k c√©lja, hogy els≈ëk√©nt tegy√©l le √∂t saj√°t jelet (X vagy O) egy megszak√≠t√°s n√©lk√ºli, egybef√ºgg≈ë vonalban a 15x15-√∂s j√°t√©kt√°bl√°n. A nyer≈ë sor lehet v√≠zszintes, f√ºgg≈ëleges vagy √°tl√≥s.</p>

                        <h2>J√°t√©km√≥dok</h2>
                        <h3>J√°t√©k G√©p Ellen (Egyj√°t√©kos m√≥d)</h3>
                        <p>Teszteld tud√°sodat a mesters√©ges intelligencia ellen! K√©t k√ºl√∂nb√∂z≈ë szem√©lyis√©g≈± √©s n√©gy neh√©zs√©gi szint≈± AI k√∂z√ºl v√°laszthatsz:</p>
                        <ul>
                            <li><b>AI Szem√©lyis√©gek:</b> Koczka Karesz (a sz√°m√≠t√≥ logikus) √©s Pikszel Panna (a kreat√≠v strat√©ga).</li>
                            <li><b>Neh√©zs√©gi Szintek:</b> K√∂nny≈±, Norm√°l, Neh√©z, G√©niusz. A magasabb szintek komoly kih√≠v√°st jelentenek, mivel az AI t√∂bb l√©p√©ssel el≈ëre gondolkodik.</li>
                        </ul>

                        <h3>T√∂bbj√°t√©kos M√≥d</h3>
                        <p>J√°tssz egy bar√°tod ellen online!</p>
                        <ul>
                            <li><b>J√°t√©k L√©trehoz√°sa:</b> Ezzel a gombbal l√©trehozol egy √∫j j√°t√©k szob√°t. A rendszer gener√°l egy egyedi, n√©gyjegy≈± <code>J√°t√©k K√≥dot</code>, amit meg kell osztanod a bar√°toddal.</li>
                            <li><b>Csatlakoz√°s:</b> Ha m√°r kapt√°l egy k√≥dot, √≠rd be a "J√°t√©k K√≥dja" mez≈ëbe, √©s kattints a Csatlakoz√°s gombra, hogy bel√©pj a bar√°tod j√°t√©k√°ba.</li>
                        </ul>

                        <h2>A J√°t√©k Menete</h2>
                        <ul>
                            <li>A j√°t√©kosok felv√°ltva helyezik el a saj√°t jel√ºket a t√°bla √ºres mez≈ëire.</li>
                            <li>Az a j√°t√©kos, aki els≈ëk√©nt sikeresen elhelyez √∂t jelet egy sorban (v√≠zszintesen, f√ºgg≈ëlegesen vagy √°tl√≥san), megnyeri az adott k√∂rt.</li>
                            <li>A pontsz√°mot a j√°t√©kpanel tetej√©n tal√°lhat√≥ sz√°ml√°l√≥ mutatja. Az "√öj K√∂r" gombbal a meccs folytathat√≥ a pontok megtart√°s√°val.</li>
                        </ul>

                        <h2>Seg√≠ts√©gek (Kalap√°cs üî® Power-up)</h2>
                        <p>A j√°t√©kot egy k√ºl√∂nleges strat√©giai elem, a Seg√≠ts√©g teszi m√©g izgalmasabb√°.</p>
                        <ul>
                            <li><b>Mi ez?</b> A Kalap√°cs (üî®) egy egyszer haszn√°latos eszk√∂z, amivel a saj√°t k√∂r√∂dben, egy jel lehelyez√©se helyett, levehetsz egyet az ellenfeled m√°r lerakott jelei k√∂z√ºl.</li>
                            <li><b>Hogyan szerezhet≈ë?</b> Minden k√∂r elej√©n a rendszer elrejt 5 darab Seg√≠ts√©get a t√°bla v√©letlenszer≈± mez≈ëin. Ha egy olyan mez≈ëre teszed a jeledet, ahol egy Seg√≠ts√©g van elrejtve, megkapod azt.</li>
                            <li><b>Hogyan haszn√°lhat√≥?</b> Amikor te k√∂vetkezel, √©s van legal√°bb egy Kalap√°csod, a j√°t√©kos paneleden akt√≠vv√° v√°lik a üî® ikon. Kattints r√°! Ekkor a t√°bla "rombol√≥ m√≥dba" v√°lt. Ezut√°n kattints az ellenf√©l b√°rmelyik jel√©re, hogy elt√°vol√≠tsd azt a t√°bl√°r√≥l. Ez a l√©p√©s felhaszn√°lja a k√∂r√∂det.</li>
                        </ul>

                        <h2>Leskel≈ëd√©s (Spectator M√≥d)</h2>
                        <p>Szeretn√©d megn√©zni m√°sok meccs√©t? A Leskel≈ëd√©s m√≥ddal megteheted.</p>
                        <ul>
                            <li>Minden j√°t√©k rendelkezik egy k√©tjegy≈± <code>Leskel≈ëd≈ë K√≥ddal</code>, amely a j√°t√©k k√∂zben l√°that√≥ a k√©perny≈ën.</li>
                            <li>A f≈ëmen√ºben v√°laszd a "Leskel≈ëd√©s" opci√≥t, add meg a neved √©s ezt a k√©tjegy≈± k√≥dot, hogy csatlakozhass n√©z≈ëk√©nt.</li>
                        </ul>

                        <h2>Statisztik√°k √©s Teljes√≠tm√©nyek</h2>
                        <p>A j√°t√©k folyamatosan menti az eredm√©nyeidet.</p>
                        <ul>
                            <li><b>Statisztik√°k:</b> K√∂vesd nyomon a Koczka Karesz √©s Pikszel Panna elleni teljes√≠tm√©nyedet, bele√©rtve a gy≈ëzelmeket, veres√©geket √©s a leghosszabb gy≈ëzelmi sorozatodat.</li>
                            <li><b>Teljes√≠tm√©nyek (Achievements):</b> Oldj fel tucatnyi k√ºl√∂nleges teljes√≠tm√©nyt k√ºl√∂nb√∂z≈ë kih√≠v√°sok teljes√≠t√©s√©vel, mint p√©ld√°ul egy meccs megnyer√©se G√©niusz fokozaton vagy 10 j√°t√©k megnyer√©se zsin√≥rban!</li>
                        </ul>

                        <p style="text-align:center; margin-top: 30px;">J√≥ sz√≥rakoz√°st √©s sikeres j√°t√©kot k√≠v√°nunk!</p>
                    </div>
                </body>
                </html>
            `;
            const rulesWindow = window.open('', '_blank');
            rulesWindow.document.write(rulesContent);
            rulesWindow.document.close();
        }
        uiElements.rulesLink.addEventListener('click', showRules);
        
        uiElements.copyCodeBtn.addEventListener('click', () => { navigator.clipboard.writeText(localGameState.gameCode).then(() => { uiElements.copyCodeBtn.textContent = 'M√°solva!'; setTimeout(() => { uiElements.copyCodeBtn.textContent = 'M√°sol√°s'; }, 2000); }); });
        function triggerVictoryConfetti() { const duration = 3 * 1000, animationEnd = Date.now() + duration; function randomInRange(min, max) { return Math.random() * (max - min) + min; } const interval = setInterval(function() { const timeLeft = animationEnd - Date.now(); if (timeLeft <= 0) { return clearInterval(interval); } const particleCount = 50 * (timeLeft / duration); const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 }; confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0, 0.1), y: Math.random() } })); confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.9, 1), y: Math.random() } })); }, 250); }
        function checkForWin(index, board, player) { if(index === null) return false; const col = index % BOARD_SIZE, row = Math.floor(index / BOARD_SIZE); const directions = [[0, 1], [1, 0], [1, 1], [1, -1]]; for (const [dx, dy] of directions) { let line = [index]; for (let i=1;i<5;i++) { const r=row+i*dy, c=col+i*dx, idx=r*BOARD_SIZE+c; if (r>=0&&r<BOARD_SIZE&&c>=0&&c<BOARD_SIZE&&board[idx]===player) line.push(idx); else break; } for (let i=1;i<5;i++) { const r=row-i*dy, c=col-i*dx, idx=r*BOARD_SIZE+c; if (r>=0&&r<BOARD_SIZE&&c>=0&&c<BOARD_SIZE&&board[idx]===player) line.push(idx); else break; } if (line.length>=5) return line; } return false; }
        
        function getStats() { return JSON.parse(localStorage.getItem('amobaProStats')) || { karesz: { games: 0, wins: 0, losses: 0, draws: 0, winStreak: 0, bestStreak: 0, powerupsFound: 0, powerupsUsed: 0 }, pikszel: { games: 0, wins: 0, losses: 0, draws: 0, winStreak: 0, bestStreak: 0, powerupsFound: 0, powerupsUsed: 0 }, totalGames: 0, totalWins: 0, totalDraws: 0, totalPowerupsFound: 0, totalPowerupsUsed: 0 }; }
        function updateStats(winner, ai, foundPowerup = false, usedPowerup = false) { const stats = getStats(); if (foundPowerup) { if (ai) stats[ai].powerupsFound++; stats.totalPowerupsFound++; } if (usedPowerup) { if (ai) stats[ai].powerupsUsed++; stats.totalPowerupsUsed++; } if (winner !== null) { stats.totalGames++; if (ai) { stats[ai].games++; if (winner === 'X') { stats[ai].wins++; stats.totalWins++; stats[ai].winStreak++; if (stats[ai].winStreak > stats[ai].bestStreak) stats[ai].bestStreak = stats[ai].winStreak; } else if (winner === 'O') { stats[ai].losses++; stats[ai].winStreak = 0; } else { stats[ai].draws++; stats.totalDraws++; stats[ai].winStreak = 0; } } } localStorage.setItem('amobaProStats', JSON.stringify(stats)); }
        function showStats() { const stats = getStats(); document.getElementById('stats-karesz-games').textContent = stats.karesz.games; document.getElementById('stats-karesz-wins').textContent = stats.karesz.wins; document.getElementById('stats-karesz-losses').textContent = stats.karesz.losses; document.getElementById('stats-karesz-draws').textContent = stats.karesz.draws; document.getElementById('stats-karesz-streak').textContent = stats.karesz.winStreak; document.getElementById('stats-karesz-best-streak').textContent = stats.karesz.bestStreak; document.getElementById('stats-pikszel-games').textContent = stats.pikszel.games; document.getElementById('stats-pikszel-wins').textContent = stats.pikszel.wins; document.getElementById('stats-pikszel-losses').textContent = stats.pikszel.losses; document.getElementById('stats-pikszel-draws').textContent = stats.pikszel.draws; document.getElementById('stats-pikszel-streak').textContent = stats.pikszel.winStreak; document.getElementById('stats-pikszel-best-streak').textContent = stats.pikszel.bestStreak; uiElements.statsModal.classList.remove('hidden'); }
        uiElements.statsBtn.addEventListener('click', showStats);
        uiElements.closeStatsBtn.addEventListener('click', () => uiElements.statsModal.classList.add('hidden'));

        const ACHIEVEMENTS_LIST = { 'first_win':{title:'Az Els≈ë L√©p√©s',description:'Nyerd meg az els≈ë j√°t√©kodat b√°rmelyik AI ellen.',icon:'üèÜ'},'first_loss':{title:'A Kezdeti Sokk',description:'Vesz√≠tsd el az els≈ë meccsedet. Sebaj, innen sz√©p nyerni!',icon:'ü§ï'},'karesz_win_1':{title:'Logikai Laposvas',description:'Gy≈ëzd le Koczka Kareszt el≈ësz√∂r.',icon:'üîß'},'pikszel_win_1':{title:'Piksel-Pacsi',description:'Gy≈ëzd le Pikszel Pann√°t el≈ësz√∂r.',icon:'‚úã'},'win_streak_3':{title:'Tripla',description:'Nyerj 3 j√°t√©kot egym√°s ut√°n.',icon:'üî•'},'win_streak_5':{title:'Lend√ºletben',description:'Nyerj 5 j√°t√©kot egym√°s ut√°n.',icon:'üöÄ'},'win_streak_10':{title:'Meg√°ll√≠thatatlan',description:'Nyerj 10 j√°t√©kot egym√°s ut√°n.',icon:'‚òÑÔ∏è'},'karesz_win_10':{title:'Karesz Ismer≈ëse',description:'Gy≈ëzd le Koczka Kareszt 10 alkalommal.',icon:'ü§ñ'},'pikszel_win_10':{title:'Pikszel Bar√°tja',description:'Gy≈ëzd le Pikszel Pann√°t 10 alkalommal.',icon:'üé®'},'both_defeated':{title:'Dupla Diadal',description:'Gy≈ëzd le Kareszt √©s Pann√°t is legal√°bb egyszer.',icon:'üëë'},'draw_master':{title:'Patthelyzet',description:'J√°tssz egy d√∂ntetlent.',icon:'ü§ù'},'hard_win':{title:'Kem√©ny Di√≥',description:'Nyerj egy meccset "Neh√©z" fokozaton.',icon:'üß†'},'genius_win':{title:'G√©prombol√≥',description:'Nyerj egy meccset "G√©niusz" fokozaton.',icon:'üí•'},'karesz_genius':{title:'Szil√≠cium-Szelid√≠t≈ë',description:'Gy≈ëzd le Kareszt G√©niusz fokozaton.',icon:'ü¶æ'},'panna_genius':{title:'Pikszel-Professzor',description:'Gy≈ëzd le Pann√°t G√©niusz fokozaton.',icon:'üéì'},'total_wins_25':{title:'Negyed Sz√°zad',description:'Nyerj √∂sszesen 25 j√°t√©kot.',icon:'üèÖ'},'total_wins_50':{title:'F√©l Sz√°zad',description:'Nyerj √∂sszesen 50 j√°t√©kot.',icon:'üéñÔ∏è'},'total_wins_100':{title:'Sz√°zados',description:'Nyerj √∂sszesen 100 j√°t√©kot.',icon:'ü•á'},'total_games_10':{title:'Bemeleg√≠t√©s',description:'J√°tssz le 10 meccset.',icon:'üëü'},'total_games_50':{title:'Kitart√≥',description:'J√°tssz le 50 meccset.',icon:'üí™'},'total_games_150':{title:'Veter√°n',description:'J√°tssz le 150 meccset.',icon:'üõ°Ô∏è'},'draw_master_5':{title:'Diplomata',description:'√ârj el 5 d√∂ntetlent.',icon:'üïäÔ∏è'},'the_rivalry':{title:'A Rivaldaf√©ny',description:'J√°tssz 25 meccset mindk√©t AI ellen.',icon:'‚öîÔ∏è'},'karesz_master':{title:'Karesz-Domin√°tor',description:'Gy≈ëzd le Koczka Kareszt 25 alkalommal.',icon:'‚ò£Ô∏è'},'pikszel_master':{title:'Pikszel-Virtu√≥z',description:'Gy≈ëzd le Pikszel Pann√°t 25 alkalommal.',icon:'üñºÔ∏è'},'unstoppable_force':{title:'Feltart√≥ztathatatlan Er≈ë',description:'√ârj el egy 15 meccses gy≈ëzelmi sorozatot.',icon:'üå†'},'both_genius':{title:'AI Apokalipszis',description:'Gy≈ëzd le mindk√©t AI-t G√©niusz fokozaton.',icon:'‚ò¢Ô∏è'},'perfect_streak':{title:'Tiszta Sor',description:'Nyerj 5 meccset zsin√≥rban ugyanaz az AI ellen.',icon:'üéØ'},'first_powerup_find':{title:'Kincsvad√°sz',description:'Tal√°ld meg az els≈ë Seg√≠ts√©gedet.',icon:'üíé'},'first_powerup_use':{title:'Taktikus',description:'Haszn√°ld fel az els≈ë Seg√≠ts√©gedet.',icon:'üî®'},'powerup_collector':{title:'B√°ny√°sz',description:'Tal√°lj 25 Seg√≠ts√©get √∂sszesen.',icon:'‚õèÔ∏è'},'powerup_master':{title:'Mesterbont√≥',description:'Haszn√°lj fel 25 Seg√≠ts√©get √∂sszesen.',icon:'üí£'},'clutch_removal':{title:'Utols√≥ Pillanatban',description:'Nyerj meg egy meccset egy Seg√≠ts√©g felhaszn√°l√°s√°val.',icon:'‚è≥'},'hoarder':{title:'Gy≈±jt√∂get≈ë',description:'Nyerj meg egy meccset √∫gy, hogy legal√°bb 3 fel nem haszn√°lt Seg√≠ts√©ged van.',icon:'üì¶'},'no_help_needed':{title:'Nincs Sz√ºks√©gem Mank√≥ra',description:'Nyerj egy meccset Neh√©z fokozaton an√©lk√ºl, hogy Seg√≠ts√©get haszn√°ln√°l.',icon:'üëä'},'powerless_genius':{title:'Puszta K√©zzel',description:'Nyerj G√©niusz fokozaton an√©lk√ºl, hogy Seg√≠ts√©get haszn√°ln√°l.',icon:'üßò'},'turnaround':{title:'Ford√≠t√°s',description:'Haszn√°lj Seg√≠ts√©get, hogy meg√°ll√≠ts egy biztos gy≈ëzelmet, majd nyerd meg a meccset.',icon:'üîÑ'},'collector':{title:'A Gy≈±jt≈ë',description:'Oldj fel 15 k√ºl√∂nb√∂z≈ë teljes√≠tm√©nyt.',icon:'üìö'},'grand_master':{title:'Nagymester',description:'Oldj fel 30 k√ºl√∂nb√∂z≈ë teljes√≠tm√©nyt.',icon:'ü•ã'},'legend':{title:'Legenda',description:'Oldj fel minden teljes√≠tm√©nyt.',icon:'üåå'}};

        function getUnlockedAchievements() { return new Set(JSON.parse(localStorage.getItem('unlockedAchievements')) || []); }
        function unlockAchievement(id) { const unlocked = getUnlockedAchievements(); if (!unlocked.has(id)) { unlocked.add(id); localStorage.setItem('unlockedAchievements', JSON.stringify([...unlocked])); showAchievementToast(ACHIEVEMENTS_LIST[id]); } }
        function showAchievementToast(achievement) { uiElements.achievementToast.textContent = `üèÜ Teljes√≠tm√©ny feloldva: ${achievement.title}`; uiElements.achievementToast.classList.add('show'); setTimeout(() => { uiElements.achievementToast.classList.remove('show'); }, 4000); }
        function displayAchievements() { const unlocked = getUnlockedAchievements(); uiElements.achievementsList.innerHTML = ''; for (const id in ACHIEVEMENTS_LIST) { const ach = ACHIEVEMENTS_LIST[id]; const isUnlocked = unlocked.has(id); uiElements.achievementsList.innerHTML += `<div class="achievement-item ${isUnlocked ? 'unlocked' : ''}"><span class="achievement-icon">${ach.icon}</span><div class="achievement-details"><h4>${ach.title}</h4><p>${ach.description}</p></div></div>`; } uiElements.achievementsModal.classList.remove('hidden'); }
        function checkAllAchievements(gameState) { const stats = getStats(); const { winner, aiPersonality, aiDifficulty } = gameState; if (winner === 'X') { unlockAchievement('first_win'); if (aiPersonality === 'karesz') unlockAchievement('karesz_win_1'); if (aiPersonality === 'pikszel') unlockAchievement('pikszel_win_1'); if (aiDifficulty === 'hard') unlockAchievement('hard_win'); if (aiDifficulty === 'genius') { unlockAchievement('genius_win'); if (aiPersonality === 'karesz') unlockAchievement('karesz_genius'); if (aiPersonality === 'pikszel') unlockAchievement('panna_genius'); } } else if (winner === 'O') { if (stats.totalGames === 1) unlockAchievement('first_loss'); } else if (winner === 'draw') { unlockAchievement('draw_master'); } if (stats.karesz.wins > 0 && stats.pikszel.wins > 0) unlockAchievement('both_defeated'); if (stats.karesz.wins >= 10) unlockAchievement('karesz_win_10'); if (stats.pikszel.wins >= 10) unlockAchievement('pikszel_win_10'); if (stats.karesz.wins >= 25) unlockAchievement('karesz_master'); if (stats.pikszel.wins >= 25) unlockAchievement('pikszel_master'); if (stats.karesz.winStreak >= 3 || stats.pikszel.winStreak >= 3) unlockAchievement('win_streak_3'); if (stats.karesz.winStreak >= 5 || stats.pikszel.winStreak >= 5) unlockAchievement('win_streak_5'); if (stats.karesz.winStreak >= 10 || stats.pikszel.winStreak >= 10) unlockAchievement('win_streak_10'); if (stats.karesz.winStreak >= 15 || stats.pikszel.winStreak >= 15) unlockAchievement('unstoppable_force'); if (stats.totalWins >= 25) unlockAchievement('total_wins_25'); if (stats.totalWins >= 50) unlockAchievement('total_wins_50'); if (stats.totalWins >= 100) unlockAchievement('total_wins_100'); if (stats.totalGames >= 10) unlockAchievement('total_games_10'); if (stats.totalGames >= 50) unlockAchievement('total_games_50'); if (stats.totalGames >= 150) unlockAchievement('total_games_150'); if (stats.totalDraws >= 5) unlockAchievement('draw_master_5'); if (stats.karesz.games >= 25 && stats.pikszel.games >= 25) unlockAchievement('the_rivalry'); if (stats.totalPowerupsFound >= 1) unlockAchievement('first_powerup_find'); if (stats.totalPowerupsUsed >= 1) unlockAchievement('first_powerup_use'); if (stats.totalPowerupsFound >= 25) unlockAchievement('powerup_collector'); if (stats.totalPowerupsUsed >= 25) unlockAchievement('powerup_master'); const unlocked = getUnlockedAchievements(); if(unlocked.has('karesz_genius') && unlocked.has('panna_genius')) unlockAchievement('both_genius'); if(unlocked.size >= 15) unlockAchievement('collector'); if(unlocked.size >= 30) unlockAchievement('grand_master'); if(unlocked.size === Object.keys(ACHIEVEMENTS_LIST).length) unlockAchievement('legend'); }
        
        uiElements.achievementsBtn.addEventListener('click', displayAchievements);
        uiElements.closeAchievementsBtn.addEventListener('click', () => uiElements.achievementsModal.classList.add('hidden'));

        getDailyQuotes();
        initializeAvatars();
    </script>
</body>
</html>
